<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="kikita's Blog"><title>如何使用py2exe打包arcpy脚本？ | kikita &amp; Maps</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-74191197-1','auto');ga('send','pageview');</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">如何使用py2exe打包arcpy脚本？</h1><a id="logo" href="/.">kikita &amp; Maps</a><p class="description">For Tech and Fun</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">如何使用py2exe打包arcpy脚本？</h1><div class="post-meta">Sep 29, 2016<span> | </span><span class="category"><a href="/categories/木工开物/">木工开物</a></span></div><div class="post-content"><p>我们可以在ArcGIS之外调用arcpy站点包运行python独立脚本，从而批量化任务提高工作效率。 如果可以把做好的脚本打包成exe是不是就更方便了呢？想想一键式处理也挺开心的。</p>
<p>Python打包的问题最早是在 <a href="http://zhihu.esrichina.com.cn/" target="_blank" rel="noopener">ArcGIS知乎</a> 中看到的，有人提问为何打包失败，我还有幸被邀请回答，虽然在这一块我也是小白一枚。 后来，得空时也搜了下相关的资源，虽然大部分人持悲观态度说arcpy不支持打包，但刚好<a href="https://geonet.esri.com/thread/164101" target="_blank" rel="noopener">有个帖子</a>说可以实现，并且宣称 “It can be done easily!”，那我就动手试试吧。</p>
<h1 id="Step1-下载安装Py2exe"><a href="#Step1-下载安装Py2exe" class="headerlink" title="Step1 下载安装Py2exe"></a>Step1 下载安装Py2exe</h1><p>Py2exe是一个Python工具发布扩展包，可以用来将Python脚本转化为Windows的可执行程序，详情看 <a href="http://py2exe.org/" target="_blank" rel="noopener">官网 py2exe.org</a> 。</p>
<p>下载Py2exe安装程序，下载地址戳 <a href="https://sourceforge.net/projects/py2exe/files/py2exe/0.6.9/" target="_blank" rel="noopener">这里</a> 。</p>
<p>ArcGIS Desktop使用的Python 2.7.x版本，可以对应下载安装 <strong><code>py2exe-0.6.9.win32-py2.7.exe</code></strong> 这个32位的版本；如果你的机器上安装 ArcGIS Desktop 64-bit Background Geoprocessing 补丁或者安装了 ArcGIS Server产品，也可以下载安装 <strong><code>py2exe-0.6.9.win64-py2.7.amd64.exe</code></strong>。 在这篇博客中，我就以 64位的包为例来说明打包的过程。</p>
<p><br></p>
<h1 id="Step2-编写脚本文件准备打包"><a href="#Step2-编写脚本文件准备打包" class="headerlink" title="Step2 编写脚本文件准备打包"></a>Step2 编写脚本文件准备打包</h1><p>打包时需要有至少两个脚本文件，一个是 <code>setup_py2exe.py</code>, 一个是执行实际任务的 <code>HelloPy2exe.py</code> 脚本文件。</p>
<p><strong>先</strong> 看第一个脚本 setup_py2exe.py，包含如下两行：</p>
<p>为了打包时包含arcpy的资源，不要忘记如下options。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">options = &#123;<span class="string">"py2exe"</span>: &#123;<span class="string">"excludes"</span>: [<span class="string">"arcpy"</span>]&#125;&#125;  </span><br><span class="line">setup(console=[<span class="string">'HelloPy2exe.py'</span>], options=options)</span><br></pre></td></tr></table></figure>
<p><strong>再</strong> 来看第二个脚本 HelloPy2exe.py：</p>
<p><code>path.dirname(interpreter)</code> 可以得到Python解释器（python.exe）的路径，并向 sys.path 添加site-packages目录。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> site <span class="keyword">import</span> addsitedir  </span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> executable  </span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path  </span><br><span class="line">interpreter = executable  </span><br><span class="line">sitepkg = path.dirname(interpreter) + <span class="string">"\\site-packages"</span> </span><br><span class="line">print(sitepkg) </span><br><span class="line">addsitedir(sitepkg)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 这里编写实际需要执行的任务 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">	print(<span class="string">'Start Processing ...'</span>)</span><br><span class="line">    main()</span><br><span class="line">    raw_input(<span class="string">"Enter enter key to exit..."</span>)</span><br></pre></td></tr></table></figure>
<p><br></p>
<h1 id="Step3-执行打包"><a href="#Step3-执行打包" class="headerlink" title="Step3 执行打包"></a>Step3 执行打包</h1><p>为了简化打包过程，可以事先做个bat文件，放在与上述连个py文件相同的目录：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python setup_py2exe<span class="selector-class">.py</span><span class="selector-class">.py</span> py2exe</span><br><span class="line">pause</span><br></pre></td></tr></table></figure>
<p>如果提示python不是有效的应用程序，那么python可以使用python.exe的绝对路径（如：C:\Python27\ArcGISx6410.4\python.exe），或者在 windows的环境变量path中添加python.exe所在的路径。</p>
<p>OK, 执行bat文件打包吧。</p>
<p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/MGKW_PythonPackage.png-kikitaMaps" alt=""></p>
<p><br></p>
<h1 id="Step4-添加PTH文件"><a href="#Step4-添加PTH文件" class="headerlink" title="Step4 添加PTH文件"></a>Step4 添加PTH文件</h1><p>为了使得exe程序可以使用arcpy的资源，需要在发布后的dist目录中增加 site-packages 文件夹，并增加 *.pth 文件，<code>...\dist\site-packages\Desktop10.4_64bit.pth</code>。</p>
<p>以64位为例，文件中需要包含如下路径（我的ArcGIS Desktop是默认路径安装的，你要看好自己路径哦）：</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:<span class="symbol">\P</span>rogram Files (x86)<span class="symbol">\A</span>rcGIS<span class="symbol">\D</span>esktop10.4<span class="symbol">\b</span>in64</span><br><span class="line">C:<span class="symbol">\P</span>rogram Files (x86)<span class="symbol">\A</span>rcGIS<span class="symbol">\D</span>esktop10.4<span class="symbol">\A</span>rcPy</span><br><span class="line">C:<span class="symbol">\P</span>rogram Files (x86)<span class="symbol">\A</span>rcGIS<span class="symbol">\D</span>esktop10.4<span class="symbol">\A</span>rcToolBox<span class="symbol">\S</span>cripts</span><br><span class="line">C:<span class="symbol">\P</span>ython27<span class="symbol">\A</span>rcGISx6410.4<span class="symbol">\L</span>ib</span><br><span class="line">C:<span class="symbol">\P</span>ython27<span class="symbol">\A</span>rcGISx6410.4<span class="symbol">\L</span>ib<span class="symbol">\s</span>ite-packages</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PS： 开头提到的帖子中，没有提到要增加 C:\Python27\ArcGISx6410.4\Lib 和 C:\Python27\ArcGISx6410.4\Lib\site-packages 这两个路径，我在执行exe时屡屡失败，不得其解。 快要放弃的时候，经过和同事讨论和测试，发现加上这两个路径，找不到 Numpy、Numbers等等包的错误就解决了，开心！</p>
</blockquote>
<p><br></p>
<p>最后，执行exe即可，这个示例中仅对两个数据进行投影变换，后面可以做些更复杂的工作。</p>
<p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/MGKW_PythonPackageExecute.png-kikitaMaps" alt=""></p>
<p><br></p>
<h1 id="后续思考"><a href="#后续思考" class="headerlink" title="后续思考"></a>后续思考</h1><p>arcpy并不是一个免费的站点包，arcpy作为ArcGIS产品的一部分，完全脱离ArcGIS产品是不行的！ Import arcpy内部其实会默默地检测产品许可的。 如果你没有产品许可，可能会遇到 “RuntimeError：NotInitialized” 这样的初始化失败的错误。</p>
<p>就现在的测试结果而言，我打包好的exe，放到其他安装有ArcGIS Desktop（64位python需要安装ArcGIS Desktop 64-bit Background Geoprocessing 补丁），ArcGIS Server的机器上都是可以正常运行的。</p>
<p>后面我会再做一些更复杂的测试，有时间的话再放上来。</p>
</div><iframe src="/donate/?AliPayQR=/img/AliPayQR.png&amp;WeChatQR=/img/WeChatQR.png&amp;GitHub=null&amp;BTCQR=null&amp;BTCKEY=null&amp;PayPal=null" style="overflow-x:hidden; overflow-y:hidden; border:0xp none #fff; min-height:240px; width:100%;" frameborder="0" scrolling="no"></iframe><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://www.kikitamap.com/2016/09/29/PackageArcpyEXE/" data-id="cjfwa8rxx00e9r4ospyx4wf8a" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJElEQVR42u3ay24DIRAEwPz/TztSTpaibLoHbxRDcbKsfVA+jAeaj494PL7G8+fnb75fc/3N93H95JcNDAyMt2U8Lkf+guQJs7uur8HAwDiH0RbZdlpJGW3fgoGBgfHT41Zaw7Y0Y2BgYNzHyEvtSlnHwMA4jbFSBNtGMFmm3rgWx8DAeEPGLBj4m8+35xsYGBj/nvEoR85bD0eLWWFgYGzNuF5w5lv5bfsYLUrj8AADA2NvRrJBlkxutn2WLFmjHwUDA+MYRlIWE0Ay6aT45htwGBgY5zDaeKCNKtsiW+AxMDC2ZsyOebXTbbfhhj8cBgbGpozZBtksSMjbwXa5i4GBsTdjtrxsN/pnMWd7vAwDA+Mcxn0lMo8Whk0nBgbGpoyVzfq2ROZRaH0lBgbGAYxZY3dHkJAviTEwMM5hzA5SrB8UmwWcdeSAgYGxEWNl46wNPvO7knsxMDBOYySPmxXW9sjFbLmLgYGxNyOPKvPucrYxly+YMTAwzmHkvuSV7Xbb7I0YGBgnM2YHUtvN+vZpS4ctMDAwtmDMlo4r0xqGkXmygYGBsR1jveDOGsFZSPnjXRgYGFsz8pE0fHm5bIPS+t8DAwNjO0Z+FHUWQ86i0PyQKwYGxjmM9UMP7c9RZKpJccfAwMAoX7wSeS61hhgYGBhlY5cU7rz1/GU+GBgYBzDali6ZUM7O44SXrcUxMDDeirEeDMyuzAvry96CgYHxfoxPc/iYThX7xR0AAAAASUVORK5CYII=">Share</a><div class="tags"><a href="/tags/ArcGIS-Pro/">ArcGIS Pro</a><a href="/tags/Python/">Python</a></div><div class="post-nav"><a class="pre" href="/2016/09/30/LineDirectioninCE/">在CityEngine中如何判断线的方向与左右？</a><a class="next" href="/2016/09/02/TripToHngKong/">Trip To HngKong</a></div><div id="lv-container" data-id="city" data-uid="MTAyMC8zMjMyOC84ODg5"><script>(function(d, s) {
   var j, e = d.getElementsByTagName(s)[0];
   if (typeof LivereTower === 'function') { return; }
   j = d.createElement(s);
   j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
   j.async = true;
   e.parentNode.insertBefore(j, e);
})(document, 'script');
</script></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/木工开物/">木工开物</a><span class="category-list-count">158</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/相机里/">相机里</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/碎碎念/">碎碎念</a><span class="category-list-count">7</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Deployment/" style="font-size: 15px;">Deployment</a> <a href="/tags/Raster/" style="font-size: 15px;">Raster</a> <a href="/tags/3D/" style="font-size: 15px;">3D</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a> <a href="/tags/ArcGIS-Pro/" style="font-size: 15px;">ArcGIS Pro</a> <a href="/tags/ArcGIS-Enterprise/" style="font-size: 15px;">ArcGIS Enterprise</a> <a href="/tags/Mapping/" style="font-size: 15px;">Mapping</a> <a href="/tags/Coordinate-System/" style="font-size: 15px;">Coordinate System</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Geoprocessing/" style="font-size: 15px;">Geoprocessing</a> <a href="/tags/Map-Story/" style="font-size: 15px;">Map Story</a> <a href="/tags/License/" style="font-size: 15px;">License</a> <a href="/tags/Geodata/" style="font-size: 15px;">Geodata</a> <a href="/tags/Spatial-Statistics/" style="font-size: 15px;">Spatial Statistics</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/CityEngine/" style="font-size: 15px;">CityEngine</a> <a href="/tags/ArcPad/" style="font-size: 15px;">ArcPad</a> <a href="/tags/CAD/" style="font-size: 15px;">CAD</a> <a href="/tags/Performance/" style="font-size: 15px;">Performance</a> <a href="/tags/Spatial-Analyst/" style="font-size: 15px;">Spatial Analyst</a> <a href="/tags/CGA/" style="font-size: 15px;">CGA</a> <a href="/tags/Visual-Studio/" style="font-size: 15px;">Visual Studio</a> <a href="/tags/Certification/" style="font-size: 15px;">Certification</a> <a href="/tags/CityEgnine/" style="font-size: 15px;">CityEgnine</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/04/10/pythonInCE/">在 CityEngine 中使用 Python</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/04/Parthenon/">Parthenon Temple</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/30/textureinCE2/">CityEngine中纹理贴图之道(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/22/textureinCE/">CityEngine中纹理贴图之道(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/21/importingmodels/">导入3D模型至CityEngine</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/18/ScentofaWoman/">《Scent of a Woman》</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/15/osm2ce/">OSM在ArcGIS产品线中的使用小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/13/CEMaplayer/">CityEngine中的Terrain Map Layer</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/26/sitebuilding/">网站主题更换备忘录</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/05/AlterXMLScheme/">解析xml修改切片原点绕开工具的坑</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://zhihu.esrichina.com.cn/" title="ArcGIS知乎" target="_blank">ArcGIS知乎</a><ul></ul><a href="http://blog.newnaw.com/" title="菩提老王的葡萄架子" target="_blank">菩提老王的葡萄架子</a><ul></ul><a href="http://oopsliu.com/" title="OopsLiu" target="_blank">OopsLiu</a><ul></ul><a href="https://makeling.github.io/" title="UBUNTU SPACE" target="_blank">UBUNTU SPACE</a><ul></ul><a href="http://blog.csdn.net/kikitamoon" title="慕名ArcGIS_CSDN" target="_blank">慕名ArcGIS_CSDN</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">kikita &amp; Maps.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>