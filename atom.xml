<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>kikita &amp; Maps</title>
  
  <subtitle>For Tech and Fun</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.kikitamap.com/"/>
  <updated>2018-11-11T10:47:06.386Z</updated>
  <id>http://www.kikitamap.com/</id>
  
  <author>
    <name>Xiaoyan Mu</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>解决七牛云存储bucket无法访问问题</title>
    <link href="http://www.kikitamap.com/2018/11/11/qiniuIssue/"/>
    <id>http://www.kikitamap.com/2018/11/11/qiniuIssue/</id>
    <published>2018-11-11T00:56:07.000Z</published>
    <updated>2018-11-11T10:47:06.386Z</updated>
    
    <content type="html"><![CDATA[<p>因为工作的事情，最近忙于切换节奏适应新环境，有一个月没来 kikitaMap “巡检”了。果然昨天发现了小故障，七牛云存储的存储空间的临时域名失效了，之上的我的图床也就挂了。涉及到的对象：<a href="https://kikitamap.com/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/" target="_blank" rel="noopener">碎碎念</a> 中的全部图片和 <a href="https://kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/" target="_blank" rel="noopener">木工开物</a> 的小部分博客中图片。Just too bad …</p><h2 id="解决方法建议"><a href="#解决方法建议" class="headerlink" title="解决方法建议"></a>解决方法建议</h2><p>这种情况下只能发工单联系技术支持了，七牛的技术支持回复比较及时，给出了解决方案，如下：</p><blockquote><p>有两种方式来获取文件：</p><p>1.<br>您需要先新建一个同区域存储空间，会分配一个新的测试域名到新空间。<br>通过qshell batchcopy 到有域名的同区域空间然后再进行qdownload下载操作<br>1）<code>qshell listbucket 原bucket名 list.txt</code><br>​       （list出全部文件，<a href="https://github.com/qiniu/qshell/blob/master/docs/listbucket.md" target="_blank" rel="noopener">listbucket的文档</a>）<br>2）<code>cat list.txt | awk &#39;{print $1}&#39; &gt;list_final.txt</code><br>​       （用awk获取list结果的第一列）<br>3）<code>qshell batchcopy 原bucket名 新bucket名 list_final.txt</code><br>​       （复制到新bucket的文件和原bucket文件名一致，<a href="https://github.com/qiniu/qshell/blob/master/docs/batchcopy.md" target="_blank" rel="noopener">batchcopy的文档</a>）<br>4）<code>qshell qdownload newfilelist.txt</code><br>​      （newfilelist.txt为下载的<a href="https://github.com/qiniu/qshell/blob/master/docs/qdownload.md" target="_blank" rel="noopener">配置文档</a>）<br> <br>qshell安装包及文档请参考<br> <a href="https://developer.qiniu.com/kodo/tools/1302/qshell" target="_blank" rel="noopener">https://developer.qiniu.com/kodo/tools/1302/qshell</a></p><p>如果您不熟悉命令行工具的安装使用，也可以结合文档最后提供的视频教程<br> <a href="https://developer.qiniu.com/kodo/tools/1302/qshell#9" target="_blank" rel="noopener">https://developer.qiniu.com/kodo/tools/1302/qshell#9</a><br> <br>2.<br>使用工具qrsctl<br><a href="https://developer.qiniu.com/kodo/tools/1300/qrsctl" target="_blank" rel="noopener">https://developer.qiniu.com/kodo/tools/1300/qrsctl</a><br><code>qrsctl get &lt;bucket&gt; &lt;file&gt; &lt;file&gt;</code></p></blockquote><h2 id="实践过程"><a href="#实践过程" class="headerlink" title="实践过程"></a>实践过程</h2><p>选择了第一种方式，问题解决，因为看起来像是批量的。</p><p>按照提示下载的zip包类似 qshell-v2.2.0.zip 这样的名字，里面包含了Windows，Linux，Mac各操作系统使用的程序。</p><p>我以Mac为例，使用Mac自带的 Commandline 访问解压之后的文件夹 qshell-v2.2.0。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kikitamoondeMBP:SoftwareSetup kikitamoon$ cd qshell-v2.2.0</span><br><span class="line">kikitamoondeMBP:qshell-v2.2.0 kikitamoon$ ls</span><br><span class="line">qshell-darwin-x64qshell-linux-x64qshell-windows-x64.exe</span><br><span class="line">qshell-linux-armqshell-linux-x86qshell-windows-x86.exe</span><br></pre></td></tr></table></figure><p>其中 qshell-darwin-x64 是Mac可用的 Qshell 版本。在使用Qshell之前需要配置账户信息，qshell account即可设置AK和SK。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kikitamoondeMBP:qshell-v2.2.0 kikitamoon$ ./qshell-darwin-x64</span><br><span class="line">Use help or help [cmd1 [cmd2 [cmd3 ...]]] to see supported commands.</span><br><span class="line">kikitamoondeMBP:qshell-v2.2.0 kikitamoon$ ./qshell-darwin-x64 account</span><br><span class="line">Open account file error, open /Users/kikitamoon/.qshell/account.json: no such file or directory, please use `account` to set AccessKey and SecretKey first</span><br><span class="line">kikitamoondeMBP:qshell-v2.2.0 kikitamoon$ ./qshell-darwin-x64 account &lt;AK&gt; &lt;SK&gt;</span><br></pre></td></tr></table></figure><p>接着使用七牛技术支持给出的建议，将旧库的文件list出来，然后batchcopy到新库中。</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">kikitamoondeMBP:</span>qshell-v2<span class="meta">.2</span><span class="meta">.0</span> kikitamoon$ ./qshell-darwin-x64 listbucket kikitamapgallery list.txt</span><br><span class="line"><span class="symbol">kikitamoondeMBP:</span>qshell-v2<span class="meta">.2</span><span class="meta">.0</span> kikitamoon$ cat list.txt | awk <span class="string">'&#123;print $1&#125;'</span> &gt;list_final.txt</span><br><span class="line"><span class="symbol">kikitamoondeMBP:</span>qshell-v2<span class="meta">.2</span><span class="meta">.0</span> kikitamoon$ ./qshell-darwin-x64 batchcopy kikitamapgallery kikitamapgallerycopy list_final.txt</span><br></pre></td></tr></table></figure><p>最后，通过 qdownload 命令下载所有源文件。在执行命令之前还需要做个配置文件，download.conf ; 并且可以设置开几个任务并行下载。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">kikitamoondeMBP:qshell-v2.2.0 kikitamoon$ ./qshell-darwin-x64 qdownload 4 download.conf</span><br><span class="line"></span><br><span class="line">Writing download log to file /Users/kikitamoon/.qshell/qdownload/7d41b43ca364d28da34dbd030f1331be/7d41b43ca364d28da34dbd030f1331be.log</span><br><span class="line">Downloading MGKW_ArcGIS_Daemon.png [1/62, 1.6%] ...</span><br><span class="line">Downloading MGKW_ArcMapStartupLog.png [2/62, 3.2%] ...</span><br><span class="line">Downloading MGKW_BatchClip.png [3/62, 4.8%] ...</span><br><span class="line">Downloading MGKW_FeatureTable.png [4/62, 6.5%] ...</span><br><span class="line">Downloading MGKW_HelloArcGISPythonAPI.png [5/62, 8.1%] ...</span><br><span class="line">....</span><br><span class="line">Downloading XJL_TripToGreece.png [61/62, 98.4%] ...</span><br><span class="line">Downloading XJL_TripToHongkong.png [62/62, 100.0%] ...</span><br><span class="line">See download log at path /Users/kikitamoon/.qshell/qdownload/7d41b43ca364d28da34dbd030f1331be/7d41b43ca364d28da34dbd030f1331be.log</span><br><span class="line"></span><br><span class="line">kikitamoondeMBP:qshell-v2.2.0 kikitamoon$</span><br></pre></td></tr></table></figure><p>至此，源图片文件算是都找回来了。当然我还需要把我的网站中使用到旧地址的位置update一下喽。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;因为工作的事情，最近忙于切换节奏适应新环境，有一个月没来 kikitaMap “巡检”了。果然昨天发现了小故障，七牛云存储的存储空间的临时域名失效了，之上的我的图床也就挂了。涉及到的对象：&lt;a href=&quot;https://kikitamap.com/categories/%
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
      <category term="Cloud Storage, Webmaster" scheme="http://www.kikitamap.com/tags/Cloud-Storage-Webmaster/"/>
    
  </entry>
  
  <entry>
    <title>矢量切片局部更新工具改进与工作收尾</title>
    <link href="http://www.kikitamap.com/2018/09/27/partialUpdateVTPKv3/"/>
    <id>http://www.kikitamap.com/2018/09/27/partialUpdateVTPKv3/</id>
    <published>2018-09-27T11:56:08.000Z</published>
    <updated>2018-09-27T14:22:17.000Z</updated>
    
    <content type="html"><![CDATA[<p>在<a href="http://kikitamap.com/2018/08/13/vectorTileBundle/" target="_blank" rel="noopener">上一篇博客</a>中提到工具还有投影坐标系支持和切片方案（.xml）自动获取的问题尚未解决，更新这篇的目的在于说明问题已经找到了workaround，并且新的版本已经在上周五（9.21）发布了。</p><h2 id="问题诊断过程"><a href="#问题诊断过程" class="headerlink" title="问题诊断过程"></a>问题诊断过程</h2><p>这两个问题其实本质上是一个问题。</p><p>我们知道，当需要生成矢量切片的地图的坐标系不是 3857（web mercator）时，ArcGIS Pro 提供的 Create Vector Tile Package / Index 工具可以自动生成与地图的坐标系统一致的切片方案（.xml）文件，默认放置于 C:\Users\当前用户\AppData\Local\ESRI\Geoprocessing 下。<br>这是个极好的功能，但是通过python调用此工具时，这个功能是没有提供接口的。此处的疑惑，也咨询了Esri US 的工程师，确实arcpy没有提供像工具UI中的自动计算功能。</p><p>在最初的版本中，我尝试使用arcpy.GenerateMapServerCacheTilingScheme_server() 来生成xml文件，可以应对地理坐标系的地图。也是这个过程中遇到了切片原点传参失败<a href="http://kikitamap.com/2018/02/05/AlterXMLScheme/" target="_blank" rel="noopener">这个坑</a>。<br>投影坐标系的切片原点不像是地理坐标系一样简单粗暴，不同的投影方法都会导致不同的原点坐标，我想过将常用坐标系枚举出来，可是从工具的通用角度来讲，不是个好事。最佳的解决方法还是想办法生成相同的xml，至少可以获取工具生成的xml。</p><p>在上个版本的局部更新矢量切片工具中，我和马老师还自命名了“Advanced Vector Tile Package”的矢量切片包，我们在矢量切片包中还打包塞入了切片方案和切片索引面。这样，局部工具在更新这种包时，可以自动解析原包获取xml和index。但是，需要用户事先使用我们定制的 Create Advanced Vector Tile Package 工具来创建矢量切片包。</p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>考虑到用户在更新矢量切片之前，已经做过该地图的矢量切片，那么在User那个目录下已经有了对应的xml文件，那么我只要代码中获取了地图的坐标系，然后按照xml的命名规则顺藤摸瓜并顺手牵羊即可。<br>现实总是比想象骨感。ArcGIS Pro 的 arcpy 中提供的 Map 对象竟然没有提供查询其坐标系统的属性或方法…… 测试基于ArcGIS Pro 2.2.1，写这篇时的最新版本。相信新的版本早晚会有的。好在我还是找到了一个workaround：从map的defaultCamera属性中获取，如下图左边最下部分所示。（现在没有测试环境，图出自讨论时的聊天记录，将就看吧）<br><img src="http://kikitamap.com/images/blogImg/partialUpdateVTPKv3_defaultCamera.jpg" alt=""></p><p>使用这个思路之后，解决了本文开头提到的问题，但是要求用户本机user目录下事先有相关的xml文件，没有的话需要打开创建矢量切片工具自动生产一次。</p><p>工具的相关代码都进行了更新，采用了新的逻辑，目前可以支持矢量切片工具自身支持的全部坐标系统。并同时保留了，上个版本的局部更新工具中可以自动解析 Advanced Vector Tile Package 功能。<br><img src="http://kikitamap.com/images/blogImg/partialUpdateVTPKv3_AdvancedSupport.jpg" alt=""></p><h2 id="工具地址"><a href="#工具地址" class="headerlink" title="工具地址"></a>工具地址</h2><p><strong>Latest Version</strong>： <a href="https://github.com/makeling/PartiallyUpateArcGISVectorTilesTools/releases/tag/3.1.0" target="_blank" rel="noopener">Partially Upate ArcGIS Vector Tiles Toolbox 3.1.0</a></p><h2 id="收尾"><a href="#收尾" class="headerlink" title="收尾"></a>收尾</h2><p>这个工具即与工作相关，又是业余之作。自己执念太重，希望在esri工作的最后一天归还机器前尽快改好发布出来，因为将来的投入时间和测试环境，不知道是否能够保证。自己可见的坑还是自己填好比较稳妥，哈。姑且把这个版本当成最后的latest版本吧。因为这个工具的更新，搞得最后一天的时间特别紧张，没有和很多同事道别，不过将来总有机会再见的。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在&lt;a href=&quot;http://kikitamap.com/2018/08/13/vectorTileBundle/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;上一篇博客&lt;/a&gt;中提到工具还有投影坐标系支持和切片方案（.xml）自动获取的问题尚未解决
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
  </entry>
  
  <entry>
    <title>Testing Report for Image Service</title>
    <link href="http://www.kikitamap.com/2018/08/30/cloudStorageImageService/"/>
    <id>http://www.kikitamap.com/2018/08/30/cloudStorageImageService/</id>
    <published>2018-08-30T03:30:40.000Z</published>
    <updated>2018-08-31T07:14:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>An image service of ArcGIS Server provides access to raster data through a web service.  ArcGIS Image Server is required to share a mosaic dataset.  This testing reporting indicates workflows and issues of sharing Image Service which is basing on a mosaic dataset referencing the raster dataset on a cloud storage.</p><p><strong>Local Testing Environment</strong></p><ul><li>Latest Esri Technologies<ul><li>ArcMap 10.6.1 ( both final release version and  early adopter version)</li><li>ArcGIS Enterprise 10.6.1 with ArcGIS Image Server 10.6.1</li></ul></li><li>Windows 10 Pro 64 bit English Version</li></ul><h2 id="Huawei-Cloud"><a href="#Huawei-Cloud" class="headerlink" title="Huawei Cloud"></a>Huawei Cloud</h2><p><strong>Steps</strong></p><ol><li><p>Create Huawei Cloud connection file                                                                (√)</p><p><img src="http://kikitamap.com/images/blogImg/cloudStorageImageService_1Connection.png" alt=""></p></li><li><p>Add raster to a local mosaic dataset referencing the connection file          (√)</p><p><img src="http://kikitamap.com/images/blogImg/cloudStorageImageService_2AddRaster.png" alt=""></p></li><li><p>Share the mosaic dataset as an image service                                                 (√)</p><p><img src="http://kikitamap.com/images/blogImg/cloudStorageImageService_3Publishing.png" alt=""></p><p><img src="http://kikitamap.com/images/blogImg/cloudStorageImageService_3Publishing2.png" alt=""></p><p><img src="http://kikitamap.com/images/blogImg/cloudStorageImageService_4ServerMan.png" alt=""></p></li><li><p>Consume this service in various client browsers                                             (√)</p><p><img src="http://kikitamap.com/images/blogImg/cloudStorageImageService_5MapViewer.png" alt=""></p><p><img src="http://kikitamap.com/images/blogImg/cloudStorageImageService_6JSviewer.png" alt=""></p><p><img src="http://kikitamap.com/images/blogImg/cloudStorageImageService_7ArcMap.png" alt=""></p></li></ol><h2 id="Alibaba-Cloud"><a href="#Alibaba-Cloud" class="headerlink" title="Alibaba Cloud"></a>Alibaba Cloud</h2><p><strong>Steps</strong></p><ol><li>Create Huawei Cloud connection file                                                                (√)</li><li>Add raster to a local mosaic dataset referencing the connection file          (√)</li><li>Share the mosaic dataset as an image service                                                 (√)</li><li>Consume this service in various client browsers                                             (×)</li></ol><p><strong>Explanation</strong></p><ul><li><p>It requires  EA version installed on English language windows OS to avoid the failure of step 1 and step 2.</p></li><li><p>Checkerboarding on image service at now. and new case summitted for diagnose this issue.</p><p><a href="https://my.esri.com/#/support/cases/02172207" target="_blank" rel="noopener">Internal Case #02172207</a> summited</p></li></ul><p><img src="http://kikitamap.com/images/blogImg/cloudStorageImageService_8Issue.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;An image service of ArcGIS Server provides access to raster data through a web service.  ArcGIS Image Server is required to share a mosai
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
      <category term="Geoprocessing" scheme="http://www.kikitamap.com/tags/Geoprocessing/"/>
    
      <category term="Python" scheme="http://www.kikitamap.com/tags/Python/"/>
    
      <category term="Raster" scheme="http://www.kikitamap.com/tags/Raster/"/>
    
      <category term="Cloud Storage" scheme="http://www.kikitamap.com/tags/Cloud-Storage/"/>
    
  </entry>
  
  <entry>
    <title>Testing Report for Raster Data Source in Cloud Storage</title>
    <link href="http://www.kikitamap.com/2018/08/15/cloudStorage4MD/"/>
    <id>http://www.kikitamap.com/2018/08/15/cloudStorage4MD/</id>
    <published>2018-08-15T01:50:20.000Z</published>
    <updated>2018-08-31T06:06:24.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>For the purpose of assisting and sharing ,  I will try to write in English. </p></blockquote><p>The new tool <strong>Create Cloud Storage Connection File</strong> is first introduced to ArcGIS Desktop 10.6.1 which is the latest version until now.  The <a href="file:///C:/Program%20Files/ArcGIS/Pro/Resources/Help/pro-app/tool-reference/data-management/create-cloud-storage-connection-file.htm" target="_blank" rel="noopener">Create Cloud Storage Connection File</a> tool creates a connection file (<strong>*.acs</strong>) for ArcGIS-supported cloud storage.  It allows existing raster geoprocessing tools to <strong>write</strong> cloud raster format (CRF) datasets into the cloud storage bucket or <strong>read</strong> raster datasets (not limited to CRF) stored in the cloud storage as input.</p><p>This is an amazing new feature of ArcGIS Desktop, including <strong>ArcMap 10.6.1</strong> and <strong>ArcGIS Pro 2.2</strong>.  The stuff from one of our partners and I are doing some researching on the new capability.  This article is something about the testing report, which indicates the feasibility of various workflows for adding raster datasets to mosaic dataset. </p><p><br></p><p><strong>Local Testing Environment</strong></p><ul><li><p>Latest Esri Technologies</p><ul><li><p>ArcMap 10.6.1</p></li><li><p>ArcGIS Pro 2.2.1</p></li></ul></li><li>Windows 10 Pro 64 bit English Version</li></ul><p><br></p><p><br></p><h2 id="Huawei-Cloud"><a href="#Huawei-Cloud" class="headerlink" title="Huawei Cloud"></a>Huawei Cloud</h2><h3 id="ArcMap"><a href="#ArcMap" class="headerlink" title="ArcMap"></a>ArcMap</h3><ul><li><p><strong>Steps</strong></p><ol><li>Create Huawei Cloud connection file                              (√)</li><li>Add raster to a local mosaic dataset                               (√)</li></ol></li><li><p><strong>Conclusion</strong></p><ul><li>Bingo !   This workflow for source raster dataset in Huawei Cloud is perfect.</li></ul></li></ul><h3 id="ArcGIS-Pro"><a href="#ArcGIS-Pro" class="headerlink" title="ArcGIS Pro"></a>ArcGIS Pro</h3><ul><li><p><strong>Steps</strong></p><ol><li><p>Create Huawei Cloud connection file                             (√)</p></li><li><p>Add Raster to Mosaic Dataset                                         (×)</p><ul><li><p>Error Message as below:</p><p>Failed to execute. Parameters are not valid.</p><p>Error: 000732  Input Data: Dataset …\HuaWeiConnection.acs\…LGN00_MTL.txt does not exist or is not supported</p></li></ul></li><li><p>Trying  workaround:  Add Raster to Mosaic Dataset using arcpy  (python 3.x for ArcGIS Pro).   </p><p>For the purpose of verification ,  Add Raster to Mosaic Dataset using arcpy  (python 2.x for ArcMap), it works.                                                                                (√) </p></li></ol></li><li><p><strong>Conclusion</strong></p><ul><li><p>It should be a bug of ArcGIS Pro,  that the  tool <strong>Add Rasters To Mosaic Dataset</strong> can not recognize the logical file path including cloud connection.  The tool will justify the path if it exists. The path containing cloud connection is a logical path , not a physical path.   The same input file path works in ArcMap.</p></li><li><p>Internal case submitted <a href="https://my.esri.com/#/support/cases/02166069" target="_blank" rel="noopener">#02166069</a>  - <em>closed</em></p><p>Related bug:  <em>BUG-000116191</em> </p><p>Workaround:  Store the rasters in the root of the bucket, and add them from that location. </p></li></ul></li></ul><p>   <br></p><h2 id="ALiBaBa-Cloud"><a href="#ALiBaBa-Cloud" class="headerlink" title="ALiBaBa Cloud"></a>ALiBaBa Cloud</h2><p>   In China, we also call it ALiYun.</p><h3 id="ArcMap-1"><a href="#ArcMap-1" class="headerlink" title="ArcMap"></a>ArcMap</h3><ul><li><p><strong>Steps</strong></p><ol><li><p>Create ALiBaBa Cloud connection file   (×)</p><p>The connection file was created,  but there was a warning:  <em>WARNING 002574: Could not connect to cloud storage</em>  in the log </p></li><li><p>Create a mosaic dataset in a local file geodatabase   (√)</p></li><li><p>Add raster to mosaic dataset   (×) </p><p>An error occurred:  <em>Error: 8004205f: No new mosaic dataset item was added.</em>  </p><p>This error may due to the warning before, I think.</p></li></ol></li><li><p><strong>Conclusion</strong></p><ul><li><p>It may be a bug related to creating connection file to ALiBaBa Cloud Storage.  ArcPy (python 27) for ArcMap didn’t work, either.</p></li><li><p>Extra diagnose</p><ul><li><p>Using Fiddler to capture the HTTP(S) requests…</p><p>I have used Fiddler Software to catch the HTTP(S) requests made by ArcMap, but nothing was found. I had enable the https capture before testing. At the same time , I checked the Windows Task Manager and Resource Monitor that there was a lot of network activities.</p></li><li><p>Using Wireshark to  capture the network transaction …</p><p>Bad TCP records were found.</p></li></ul></li></ul></li></ul><h3 id="ArcGIS-Pro-1"><a href="#ArcGIS-Pro-1" class="headerlink" title="ArcGIS Pro"></a>ArcGIS Pro</h3><ul><li><p><strong>Steps</strong></p><ol><li>Create ALiBaBa Cloud connection file                              (×)</li><li>Create a mosaic dataset in a local file geodatabase      (√)</li><li>Add raster to mosaic dataset                                             (×)</li></ol></li><li><p><strong>Conclusion</strong></p><ul><li>Same issue with using HUAWEI cloud source data, and the issue points to the tool not to the cloud itself.</li><li>ArcPy (python 36) for ArcGIS Pro didn’t work, either.</li></ul></li></ul><p>Internal case submitted  <a href="https://my.esri.com/#/support/cases/02157762" target="_blank" rel="noopener">#02157762</a></p><p>Related bug:  <em>BUG-000116297</em></p><p>Workaround:  Internal Version 9226</p><p><br></p><h2 id="Custom-Cloud"><a href="#Custom-Cloud" class="headerlink" title="Custom Cloud"></a>Custom Cloud</h2><p>using s3 compatible cloud, for example,  Tencent Cloud.</p><ul><li><p><strong>Steps</strong></p><ol><li>Create Tencent Cloud connection file using ArcPy (python 27) for ArcMap </li><li>Capture network interaction information using WireShark<ul><li>As Amazon Provider selected, the region and endpoint will request Amazon CNAME address. In this condition, I don’t think the custom cloud works for now.</li></ul></li></ol></li><li><p>Internal case submitted</p><p><a href="https://my.esri.com/#/support/cases/02157772" target="_blank" rel="noopener">#02157772 Can Service End Point parameter be customized by users when connecting to the cloud storage ?</a> </p></li></ul><p><br></p><h2 id="Other-Issue"><a href="#Other-Issue" class="headerlink" title="Other Issue"></a>Other Issue</h2><p>failure with file Geodatabase transfer</p><ul><li><p><strong>Details</strong></p><p>When the file geodatabase was copied to a new location ,which was some scheme of path as before, on the other new machine . The mosaic dataset didn’t show up the source raster data at all. </p></li><li><p>Internal case submitted</p><p><a href="https://my.esri.com/#/support/cases/02165287" target="_blank" rel="noopener">#02165287 how to transfer mosaic dataset referencing raster dataset in cloud storage</a> </p></li></ul><p><br></p><p><br></p><p>The information above is valid as the day it published, I will try my best to have it up to date.</p><p>Thank you for reviewing.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;For the purpose of assisting and sharing ,  I will try to write in English. &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The new tool &lt;strong&gt;Creat
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
      <category term="Geoprocessing" scheme="http://www.kikitamap.com/tags/Geoprocessing/"/>
    
      <category term="Python" scheme="http://www.kikitamap.com/tags/Python/"/>
    
      <category term="Raster" scheme="http://www.kikitamap.com/tags/Raster/"/>
    
      <category term="Cloud Storage" scheme="http://www.kikitamap.com/tags/Cloud-Storage/"/>
    
  </entry>
  
  <entry>
    <title>探索矢量切片的Bundle</title>
    <link href="http://www.kikitamap.com/2018/08/13/vectorTileBundle/"/>
    <id>http://www.kikitamap.com/2018/08/13/vectorTileBundle/</id>
    <published>2018-08-13T02:13:29.000Z</published>
    <updated>2018-08-14T02:56:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>为什么会有这个需求和想法呢？还是源自于 <a href="http://kikitamap.com/2018/07/20/lovelyGit/" target="_blank" rel="noopener"><strong>局部更新矢量切片</strong></a> 的想法，当我们遭遇一个海量矢量数据的矢量切片<strong>创建</strong>和<strong>更新</strong>任务时，希望尽可能少且尽可能准确地更新受影响的bundle，而不是全局，那么了解bundle的范围是十分必要的。在写上一篇<a href="http://kikitamap.com/2018/07/23/CompactCache/" target="_blank" rel="noopener"><strong>《紧凑型缓存技术小结》</strong></a>的时候，目的在于在其基础之上探索矢量切片的bundle。</p><p>为了确保单个bundle文件的矢量切片数据的完整性，每级每次至少需要更新一个bundle文件。当矢量切片的数据量不显著的时候，可能每级本身也就一个或几个bundle，那局部更新体现不出它的优势； 当某些等级（例如LOD比较大的级别）矢量切片bundle非常多的时候，如果更新的范围只影响了其中一个，或者几个文件时，局部更新是有必要的。</p><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>参照栅格切片的 <a href="http://enterprise.arcgis.com/en/server/latest/publish-services/windows/inside-the-compact-cache-storage-format.htm" target="_blank" rel="noopener">帮助文档</a> 中明确说明的，  “A bundle contains up to 16,384 tiles. ”   那就是 128 × 128 的关系，照搬到矢量切片是否适用呢？ 通过验证，确实如此。</p><p>先上结论，第N级的矢量切片的bundle范围刚好是第N-7级的切片范围，如下图，红线是 level 6 的切片索引，刚好可以作为level 13 的bundle范围：</p><p><img src="http://kikitamap.com/images/blogImg/vectorTileBundle_bundlelevel.png" alt=""></p><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>为了做验证和测试，我用了美国大选的区块数据做实验，这个面数据包含182895条记录，节点较多，很适合做矢量切片。假设，需要更新的切片范围仅仅是密歇根湖的一角：</p><p><img src="http://kikitamap.com/images/blogImg/vectorTileBundle_UpdateDetails.png" alt=""></p><blockquote><p>PS：上图是完全由 ArcGIS Pro 制作导出的，使用到了 Layout , Extent Indicator; 从制图角度来说，ArcGIS Pro 是个非常好的桌面端应用，可以继承和超越ArcMap。 </p></blockquote><p>以13级为例，更新的这一角仅需替换一个bundle：</p><p><img src="http://kikitamap.com/images/blogImg/vectorTileBundle_BundleReplace.png" alt=""></p><p>那么自定义工具 Create Part Vector Tile Package 所要做的工作，逻辑就变得非常清晰，也就是通过用户提供的待更新区域（AOI）来计算每级被影响到的bundle文件的地理范围，从而进行bundle的替换工作；包含了为其服务的，解包、打包、解析类的工作。</p><h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><p><strong>Latest Version：</strong>   <a href="https://github.com/makeling/PartiallyUpateArcGISVectorTilesTools/releases/tag/2.1.1" target="_blank" rel="noopener">Partially Upate ArcGIS Vector Tiles Toolbox 2.1.1</a></p><p><strong>待解决的问题</strong>：</p><ul><li>投影坐标系和自定义坐标系支持</li><li>tile scheme 原生获取</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;为什么会有这个需求和想法呢？还是源自于 &lt;a href=&quot;http://kikitamap.com/2018/07/20/lovelyGit/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;strong&gt;局部更新矢量切片&lt;/strong&gt;&lt;/a&gt; 的想法
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
      <category term="Web" scheme="http://www.kikitamap.com/tags/Web/"/>
    
      <category term="ArcGIS Pro" scheme="http://www.kikitamap.com/tags/ArcGIS-Pro/"/>
    
      <category term="ArcGIS Enterprise" scheme="http://www.kikitamap.com/tags/ArcGIS-Enterprise/"/>
    
      <category term="Vector Tiles" scheme="http://www.kikitamap.com/tags/Vector-Tiles/"/>
    
  </entry>
  
  <entry>
    <title>紧凑型缓存技术小结</title>
    <link href="http://www.kikitamap.com/2018/07/23/CompactCache/"/>
    <id>http://www.kikitamap.com/2018/07/23/CompactCache/</id>
    <published>2018-07-23T04:49:48.000Z</published>
    <updated>2018-07-31T05:05:42.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Tiling-Scheme"><a href="#Tiling-Scheme" class="headerlink" title="Tiling Scheme"></a>Tiling Scheme</h2><p>每个缓存服务的切片目录中都会包含一个 <strong>Conf.xml</strong>，也是就是tile scheme 文件了。</p><p>这个文件包含了很多有关切片设置的信息：</p><ul><li>Spatial reference information</li><li>Tile origin</li><li>Tile width/height</li><li>DPI</li><li>LODs (Levels of detail - scales)</li><li>Tile Image format</li><li>Compression quality</li><li>Antialiasing settings</li><li>Storage method</li></ul><h2 id="Version-Issue"><a href="#Version-Issue" class="headerlink" title="Version Issue"></a>Version Issue</h2><p>紧凑型缓存的存储格式为<strong>.bundle</strong> 。但有时我们会看到缓存目录中包含<strong>.bundlx</strong> 这样的文件，这说明这些缓存是ArcGIS 10.2.2 或以下版本创建的。从 ArcGIS 10.3 开始，紧凑型缓存做了些改进， .bundlx（tile index information） 文件被包含到了 .bundle 文件中 ，从而进一步降低了文件的数量。</p><p>你可以在缓存服务的tiling scheme “<strong>Conf.xml</strong>“ 中查看确认：</p><p><em>10.3 or later (Compact cache V1)</em></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">CacheStorageInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:CacheStorageInfo'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">StorageFormat</span>&gt;</span>esriMapCacheStorageModeCompact<span class="tag">&lt;/<span class="name">StorageFormat</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PacketSize</span>&gt;</span>128<span class="tag">&lt;/<span class="name">PacketSize</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">CacheStorageInfo</span>&gt;</span></span><br></pre></td></tr></table></figure><p><em>10.2.2 or former (Compact cache V2)</em></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">CacheStorageInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:CacheStorageInfo'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">StorageFormat</span>&gt;</span>esriMapCacheStorageModeCompactV2<span class="tag">&lt;/<span class="name">StorageFormat</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PacketSize</span>&gt;</span>128<span class="tag">&lt;/<span class="name">PacketSize</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">CacheStorageInfo</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>10.3 及之后版本的 ArcGIS Server 仍然可以使用低版本的生产的切片来运行现有服务。如果我们需要将低版本的缓存拷贝过来给高版本的服务用，要注意这个<code>&lt;StorageFormat&gt;</code>参数的一致性。</li><li>ArcToolbox工具 <strong>Upgrade Map Server Cache Storage Format</strong>  来升级缓存。升级的过程中不会重新创建切片，而是重组原有的切片。这个工具在ArcGIS Pro 中没有提供。目前，我们还只能使用ArcMap或者使用ArcGIS Server 带有的arcpy包，通过Python来调用。</li><li>不支持将高版本的切片供低版本软件使用。如果希望降级，可以使用 <strong>Export Map Server Cache</strong> 工具导出紧凑型切片。</li></ul><h2 id="Tile-Format"><a href="#Tile-Format" class="headerlink" title="Tile Format"></a>Tile Format</h2><p>Tile Format 是指存储切片使用了何种栅格格式，而不是切片文件的本身存储格式 / Storage Format ( Exploded / Compact )。</p><ul><li><p><strong>PNG</strong>   </p><p>ArcGIS 10.1开始引入的类型。选择这种类型，Server会自行确认每张切片的PNG位深，从而达到缩减磁盘占用的目的。在我们不确定使用何种PNG格式时，保持这个默认设置就不错。</p><p>如果磁盘空间不在考虑范围下，而希望优先考虑切片速度，那最好选择MIXED格式了。</p></li><li><p><strong>PNG8</strong></p><p>位深为8位的PNG图片格式；可以最多存储256色，支持布尔透明，磁盘空间占用小，并且无损。适合于颜色相对简单，并且需要透明背景的地图，例如公路数据切图。</p></li><li><p><strong>PNG24</strong></p><p>位深为24的PNG图片格式；可以最多支持约1600万色。当地图的色彩复杂程度超过256时，你就该考虑使用这个格式。但是，PNG24不支持透明，另外不建议在IE6及以前版本浏览器中使用。</p></li><li><p><strong>PNG32</strong></p><p>在PNG24的基础上增加了Alpha通道，因而增加了各种程度半透明的支持。当地图色彩复杂，并开启了抗锯齿功能，PNG32就是最佳选择了，并且PNG32在各个版本的浏览器中支持良好。</p></li><li><p><strong>JPEG</strong></p><p>当切片中不需要透明背景时，JPEG是最常用的切片格式，并且JPEG可以hold住大量的复杂色彩。例如，包含影像、符号化精细程度高的矢量地图都可以使用这个格式。</p><p>JPEG是种有损压缩格式，可以在1%-100%间设置压缩比率，默认值75%一般是显示质量和磁盘空间的最佳平衡。如果觉得噪点过多质量不够，可以调高这个百分比，但你需要在响应性能和图片质量之间做好博弈。</p></li><li><p><strong>MIXED</strong></p><p>顾名思义，混合格式，在切片不透明区域使用JPEG，在透明区域使用PNG32。这是种非常智能的搭配方案，降低硬盘占用的同时，很好的解决了例如在切片边缘需要的透明需求。</p></li><li><p><strong>LERC</strong></p><p>LERC是Esri自主研发的开源的有损压缩格式，点<a href="http://esri.github.io/lerc/" target="_blank" rel="noopener">这里</a>有更多信息。推荐用于位深较大的单波段影像或高程数据服务中，如浮点型，32-bit、16-bit、12-bit的数据。 官方声称，LERC压缩方法在压缩速度和压缩质量方面分别是LZ77的5-10倍。当LERC用于整型栅格数据时，损失率在0.99或更低，几乎可以视为无损压缩。</p><p>LERC压缩方式目前只支持Image Service ，而不支持 Map Service。</p></li></ul><h2 id="Performance-Suggestion"><a href="#Performance-Suggestion" class="headerlink" title="Performance Suggestion"></a>Performance Suggestion</h2><p>紧凑型切片比松散型切片有诸多有点，详见文末的官方文档。但不是说选了紧凑型切片性能就没有继续改善的余地了，下面的这些点也是提升切片性能的一些有效建议：</p><ul><li>地图数据尽可能使用本地数据，共享目录的数据切片时间可能会更长些；</li><li>尽可能的避免使用动态投影；</li><li>设置图层的可见比例尺；</li><li>谨慎设置反锯齿的级别，标注的反锯齿对切片性能影响甚微，但要素符号的反锯齿会显著增长切片的时长；</li><li>建议切片期间关闭防病毒等安全软件；</li><li>尽可能地使用MIXED格式</li><li>在切片之前为所有数据创建空间索引</li><li>CachingTools服务的最大实例数 = 核数 + 1，这是官方给出的最佳实践建议</li><li>降低日志的级别，如果在大量切图任务中把Server日志开到Debug或Verbose级别，会产生极大的资源浪费。</li></ul><h2 id="Tile-SuperTile-Bundle"><a href="#Tile-SuperTile-Bundle" class="headerlink" title="Tile|SuperTile|Bundle"></a>Tile|SuperTile|Bundle</h2><p>这三者的关系早在多年前就有大牛们探索发现过，见本文末的相关文章，文中有逻辑缜密且经得起时间检验的详细演绎过程……</p><p>简言之，他们的关系是个简单的数学关系，如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">如果：</span><br><span class="line">    Tile = <span class="number">256</span> × <span class="number">256</span> pixel             <span class="comment"># 256×256 是ArcGIS Server默认的切片大小</span></span><br><span class="line">    Supertile = <span class="number">4096</span> × <span class="number">4096</span> pixel      <span class="comment"># 未开抗锯齿情况下是 4096×4096</span></span><br><span class="line">那么：</span><br><span class="line">Supertile = <span class="number">16</span> × <span class="number">16</span> Tile           </span><br><span class="line">已知：</span><br><span class="line">Bundle = <span class="number">128</span> × <span class="number">128</span> Tile            </span><br><span class="line">因此：</span><br><span class="line">Bundle 范围是 N<span class="number">-3</span> 级的 Supertile 的范围</span><br></pre></td></tr></table></figure><p>看图说话：</p><p><img src="http://kikitamap.com/images/blogImg/CompactCache_SupertileBundle.png" alt=""></p><blockquote><p><em>官方文档：</em></p><ul><li><a href="http://enterprise.arcgis.com/zh-cn/server/latest/publish-services/windows/inside-the-compact-cache-storage-format.htm" target="_blank" rel="noopener">了解紧凑型缓存存储格式</a></li></ul><p><em>相关文章：</em></p><ul><li><a href="http://blog.newnaw.com/?p=789" target="_blank" rel="noopener">菩提老王的葡萄架子：ArcGIS Server 10中的切图/缓存机制深入</a></li><li><a href="https://blog.csdn.net/warrenwyf/article/details/6069711" target="_blank" rel="noopener">牛魔王的作坊：ArcGIS 切片缓存紧凑文件格式分析与使用</a></li><li><a href="https://blog.csdn.net/arcgis_all/article/details/50536569" target="_blank" rel="noopener">ArcGIS产品与技术专栏：Esri中国ArcGIS for Server 10.3.X 新型紧凑型缓存的解读和应用</a></li></ul></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Tiling-Scheme&quot;&gt;&lt;a href=&quot;#Tiling-Scheme&quot; class=&quot;headerlink&quot; title=&quot;Tiling Scheme&quot;&gt;&lt;/a&gt;Tiling Scheme&lt;/h2&gt;&lt;p&gt;每个缓存服务的切片目录中都会包含一个 &lt;strong
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
  </entry>
  
  <entry>
    <title>Contributing to Our Github Project</title>
    <link href="http://www.kikitamap.com/2018/07/20/lovelyGit/"/>
    <id>http://www.kikitamap.com/2018/07/20/lovelyGit/</id>
    <published>2018-07-20T09:47:40.000Z</published>
    <updated>2018-07-24T03:40:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>这是一篇日记。</p><p>最近，终于把年初我和<a href="https://makeling.github.io/" target="_blank" rel="noopener">马老师</a>的脑洞项目 <a href="https://github.com/makeling/PartiallyUpateArcGISVectorTilesTools" target="_blank" rel="noopener"><strong>局部更新矢量切片</strong></a> 放在了大型程序员G友交流社区，开始出 <a href="https://github.com/makeling/PartiallyUpateArcGISVectorTilesTools/releases" target="_blank" rel="noopener">release</a>了…… </p><p>在项目的开始，这个需求来自于用户的真实需求，如下是正经的背景信息：</p><blockquote><p>矢量切片是Esri在新版本中推出的一项亮点新技术，通过ArcGIS Pro中的Create Vector Tile Service工具生成切片包，再通过Portal发布成 Vector Tile Service，在前端支持各种应用，采用统一的接口进行调用，实现了一体化的平台应用解决方案。矢量切片技术充分利用GPU的渲染能力，以全新方式在设备、浏览器中以矢量的方式展现缓存地图。这项技术解决了传统基于栅格缓存切片展现地图存在的诸多问题：如设备分辨率对地图渲染效果的影响，缓存创建后无法再动态更改样式，生成缓存切片的周期过长，对硬件的需求过大等等。</p><p>众所周知，矢量切片包的生成速度相对于传统的栅格切片包具有指数极的性能提升，这也是体现矢量切片优越性的一个重要方面。对于一个常规数据量在100MB-10GB级的数据，全部生成一次矢量切片包的速度在分钟级。可能正是因为这个原因，截至目前最新版本（ArcGIS Pro 2.2），Esri仍未提供局部更新矢量切片包的功能。虽然矢量切片生成速度很快，但是到了TB级别的大数据来说，生成一次完整的切片包也是需要相当长的时间的，如果仅是更新了局部的小范围数据，那基于更新范围自动化更新矢量切片就是一个非常有实际应用价值的需求。 正是在这样的背景下，我们发起了创建自动化局部更新矢量切片工具的项目。</p><p>—— @马老师</p></blockquote><p>既然是两个人的项目，又会涉及很多版本的更新同步问题，<em>Why not Github</em> ？</p><p>我们一共设计了5个Python工具，用于扩展ArcGIS Pro的功能，分别实现原始矢量切片包的创建，局部矢量切片包的创建，以及矢量切片包的更新，矢量切片服务的更新，托管在阿里云平台的矢量切片服务的更新。</p><p>截止到今天的版本 <a href="https://github.com/makeling/PartiallyUpateArcGISVectorTilesTools/releases/tag/1.1.0" target="_blank" rel="noopener">Partially Upate ArcGIS Vector Tiles Toolbox 1.1.0</a></p><p><strong>Mark：</strong></p><p>后续还有很多有待优化的关键点：</p><ul><li>Bundle空间范围的精确计算</li><li>LOD值的自动计算</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;这是一篇日记。&lt;/p&gt;
&lt;p&gt;最近，终于把年初我和&lt;a href=&quot;https://makeling.github.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;马老师&lt;/a&gt;的脑洞项目 &lt;a href=&quot;https://github.com/ma
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
      <category term="Web" scheme="http://www.kikitamap.com/tags/Web/"/>
    
      <category term="Python" scheme="http://www.kikitamap.com/tags/Python/"/>
    
      <category term="Github" scheme="http://www.kikitamap.com/tags/Github/"/>
    
      <category term="Vector Tiles" scheme="http://www.kikitamap.com/tags/Vector-Tiles/"/>
    
  </entry>
  
  <entry>
    <title>你知道 CityEngine 中的 Leaf Shape 吗？</title>
    <link href="http://www.kikitamap.com/2018/07/13/CELeafshape/"/>
    <id>http://www.kikitamap.com/2018/07/13/CELeafshape/</id>
    <published>2018-07-13T02:50:36.000Z</published>
    <updated>2018-07-13T06:29:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>CityEngine 的CGA建模过程是个不断迭代繁衍的过程，我们将这个过程想象成一棵树。</p><p>通过 Shapefile，File Geodatabase，AutoCAD DXF 这些矢量数据格式导入CityEngine中的2D基面（Footprint），通常称为 CityEngine <strong>Initial Shape</strong>，这是这棵树的根节点。通过CGA中的命令符 <code>--&gt;</code> ，将一个shape经过各种形状（Geometry）和位置（Pivot，Scope） 的函数操作，生成另一个shape。直到最后，模型建立，最终的shape节点，通常称为 CityEngine <strong>Leaf Shape</strong>。</p><blockquote><p>这个细节的概念，在2013年的开发者大会中提过一次，结合模型层次结构的幻灯片理解下：</p><p><img src="http://kikitamap.com/images/blogImg/CELeafShape_2013DS.png" alt=""></p><p><img src="http://kikitamap.com/images/blogImg/CELeafShape_2013DS2.png" alt=""></p><p>完整的幻灯片可以点 <a href="https://github.com/kikitaMoon/kikitamap.github.io/blob/gh-pages/attaches/EsriChinaDevSum-2013-EsriCityEngine%E8%A7%84%E5%88%99%E5%BC%80%E5%8F%91-%E6%85%95%E6%99%93%E7%87%95.pdf" target="_blank" rel="noopener"><strong>这里</strong></a> 下载。</p></blockquote><p>为什么说是“迭代繁衍”？ 因为除了 Leaf Shape 之外的所有shape 在建模过程中都被紧跟它其后的shape替代而消亡了。</p><p>举例子，在这条规则中，</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A --&gt; function() B </span><br><span class="line">      B  --&gt; function() C</span><br></pre></td></tr></table></figure><p>这条规则中 ，A shape 对象已经消亡被B替代，在后续的规则中无法再调用到 A， 如果希望取到与A相同的对象，就需要提前复制出来，如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A --&gt; <span class="function">Anew <span class="title">function</span><span class="params">()</span> B            <span class="comment">//A被复制而创建了分支</span></span></span><br><span class="line"><span class="function">      B    --&gt; <span class="title">function</span><span class="params">()</span> C</span></span><br><span class="line"><span class="function">      Anew --&gt; <span class="title">function</span><span class="params">()</span> D</span></span><br></pre></td></tr></table></figure><p>了解了这些，那么我们可以进一步回答这个问题：“如何将CityEngine规则建模的模型导出成各组件独立存储的模型？”   </p><p>可以的，再导出FileGDB或 Scene Layer Package的时候选中 “<strong>One Feature per Leaf Shape</strong>” 即可。</p><p><img src="http://kikitamap.com/images/blogImg/CELeafShape_FGDB.png" alt="Export to FileGDB"></p><p><img src="http://kikitamap.com/images/blogImg/CELeafShape_SLPK.png" alt="Export to Scene Layer Package"></p><p>这些导出的模型数据拿到其他软件中使用，例如ArcGIS Pro，各组件即为不同的静态模型对象。</p><p><img src="http://kikitamap.com/images/blogImg/CELeafShape_Pro.png" alt=""></p><p><em>这个示例的CGA脚本在 <a href="https://github.com/kikitaMoon/BuildingCGA/tree/master/Demoforkikitamap.com/4-FloorsAsLeafshape" target="_blank" rel="noopener">我的<strong>Github</strong></a> 可以查看和下载。</em></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CityEngine 的CGA建模过程是个不断迭代繁衍的过程，我们将这个过程想象成一棵树。&lt;/p&gt;
&lt;p&gt;通过 Shapefile，File Geodatabase，AutoCAD DXF 这些矢量数据格式导入CityEngine中的2D基面（Footprint），通常称为
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
      <category term="3D" scheme="http://www.kikitamap.com/tags/3D/"/>
    
      <category term="CityEngine" scheme="http://www.kikitamap.com/tags/CityEngine/"/>
    
      <category term="ArcGIS Pro" scheme="http://www.kikitamap.com/tags/ArcGIS-Pro/"/>
    
      <category term="CGA" scheme="http://www.kikitamap.com/tags/CGA/"/>
    
  </entry>
  
  <entry>
    <title>如何获取30天试用版 Esri CityEngine ？</title>
    <link href="http://www.kikitamap.com/2018/07/11/CEFreeTrial/"/>
    <id>http://www.kikitamap.com/2018/07/11/CEFreeTrial/</id>
    <published>2018-07-11T09:43:04.000Z</published>
    <updated>2018-07-11T09:31:17.000Z</updated>
    
    <content type="html"><![CDATA[<p>Esri CityEngine 是一款面向于大规模城市规划行业的，交互式、沉浸式高级三维建模软件，相比传统建模更加高效省时。 通过CityEngine我们可以基于现实世界的GIS数据，构造城市的现实状态，模拟城市的历史风貌，设计城市的未来蓝图。</p><p>如何申请Esri CityEngine 30天试用？</p><h2 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1"></a>Step 1</h2><p>访问Esri官方试用地址：<a href="https://www.esri.com/en-us/arcgis/products/esri-cityengine/trial" target="_blank" rel="noopener">https://www.esri.com/en-us/arcgis/products/esri-cityengine/trial</a></p><p> 点击“<strong>Start CityEngine Trial</strong>”</p><p><img src="http://kikitamap.com/images/blogImg/CEFreeTrial_Start.png" alt=""></p><h2 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h2><p>创建一个Esri账号，点击“<strong>Create a Public Account</strong>”； 如果已经拥有过 Esri 账号，可以直接登录。</p><blockquote><p>PS：每个邮箱只能申请一次试用。请申请试用时，确保邮箱是第一次注册。</p><p>​         国内不建议使用Facebook和Google账户登录，避免后续登录的麻烦，你懂的。</p></blockquote><p><img src="http://kikitamap.com/images/blogImg/CEFreeTrial_SignUp.png" alt=""></p><p>在新的创建账户的页面中添加，名字、姓氏、邮箱，点击创建账户按钮，直至收到如下提示。</p><blockquote><p>Thank you for signing up.</p><p>An e-mail has been sent to [上一步填写过的邮箱]</p></blockquote><h2 id="Step-3"><a href="#Step-3" class="headerlink" title="Step 3"></a>Step 3</h2><p>查看自己的邮箱，你会发现类似的一封，点击 “<strong>Activate Your Account</strong>”。</p><p><img src="http://kikitamap.com/images/blogImg/CEFreeTrial_Activate.png" alt=""></p><p>在弹出页面中，填写标星号的必要信息，例如：用户名、密码、国家、安全问题。然后点击创建账户。</p><p><img src="http://kikitamap.com/images/blogImg/CEFreeTrial_CreateUserName.png" alt=""></p><h2 id="Step-4"><a href="#Step-4" class="headerlink" title="Step 4"></a>Step 4</h2><p>选择几项附加信息，点击下一步，会看到最终的包含了类似 <strong><code>EVA123456789</code></strong> 格式授权码的页面。</p><p><img src="http://kikitamap.com/images/blogImg/CEFreeTrial_IndustryInfo.png" alt=""></p><p><img src="http://kikitamap.com/images/blogImg/CEFreeTrial_EVAcode.png" alt=""></p><p>请记录这个号码以备后用。如果忘记了也没有关系，注册邮箱中也会收到一封 “<strong>Esri CityEngine Trial Confirmation</strong>”主题的邮件，可以查询。</p><h2 id="Step-5"><a href="#Step-5" class="headerlink" title="Step 5"></a>Step 5</h2><p>下载并安装 Esri CityEngine 2018 软件。</p><p>如果不确认自己的系统是否满足安装要求，请查看 <strong><a href="http://desktop.arcgis.com/en/cityengine/latest/get-started/esri-cityengine-system-requirements.htm" target="_blank" rel="noopener">Esri CityEngine 系统要求</a></strong> 。</p><p>大多数情况下，我们安装在 Windows 操作系统中；当然 CityEngine 也支持 Mac OS X，Linux。</p><p>安装过程简单，与常规应用程序无差，按向导下一步即可完成，不赘述。</p><h2 id="Step-6"><a href="#Step-6" class="headerlink" title="Step 6"></a>Step 6</h2><p>启动开始菜单 Esri CityEngine 目录下的 <strong>CityEngine 2018 Administrator</strong>。</p><p>选择左侧 CityEngine 节点，右边选择 <strong>高级版单机许可</strong>，点击下方的 “<strong>Authorize Now</strong>”。</p><p><img src="http://kikitamap.com/images/blogImg/CEFreeTrial_AdvSingleUse.png" alt=""></p><p>按照默认设置，一直下一步，并填写带信号的信息即可。</p><p><img src="http://kikitamap.com/images/blogImg/ArcMap60DayFreetrial_Authorize.png" alt=""></p><p><img src="http://kikitamap.com/images/blogImg/ArcMap60DayFreetrial_Internet.png" alt=""></p><p>填写入CityEngine的授权号码，下一步，直至看到祝贺页面即授权成功。</p><p><img src="http://kikitamap.com/images/blogImg/CEFreeTrial_FillinEVA.png" alt=""></p><p><img src="http://kikitamap.com/images/blogImg/ArcMap60DayFreetrial_Congrs.png" alt=""></p><p>从开始菜单，启动CityEngine软件即可。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Esri CityEngine 是一款面向于大规模城市规划行业的，交互式、沉浸式高级三维建模软件，相比传统建模更加高效省时。 通过CityEngine我们可以基于现实世界的GIS数据，构造城市的现实状态，模拟城市的历史风貌，设计城市的未来蓝图。&lt;/p&gt;
&lt;p&gt;如何申请Esr
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
      <category term="Deployment" scheme="http://www.kikitamap.com/tags/Deployment/"/>
    
      <category term="CityEngine" scheme="http://www.kikitamap.com/tags/CityEngine/"/>
    
  </entry>
  
  <entry>
    <title>在 CityEngine 中使用 Python</title>
    <link href="http://www.kikitamap.com/2018/04/10/pythonInCE/"/>
    <id>http://www.kikitamap.com/2018/04/10/pythonInCE/</id>
    <published>2018-04-10T09:40:11.000Z</published>
    <updated>2018-07-13T06:17:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>​        CityEngine的同义词几乎就是“规则建模”，规则指的是CGA脚本。说到脚本，很多用户又会联想到 Python， 衍生出来的问题就是，“CityEngine中是用python脚本建模吗？”  答案是No。</p><p>​         CityEngine中确实也引入了python，只不过使用python的姿势不是建模，而是自动化。通过python脚本，可以增强CityEngine的建模功能，自动化驱动脚本建模工作流，提高建模效率。我们既可以在控制台交互式执行python命令，也可以在python editor 中书写python执行文件，甚至可以将一些自定义功能扩展到CityEngine中。如下是CityEngine官方教程中的几个示例代码：</p><h2 id="Example-1-选择部分对象"><a href="#Example-1-选择部分对象" class="headerlink" title="Example 1  选择部分对象"></a>Example 1  选择部分对象</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Created on 2018-4-9</span></span><br><span class="line"><span class="string">@author: kikita</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">from</span> scripting <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># get a CityEngine instance</span></span><br><span class="line">ce = CE()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">selectByAttribute</span><span class="params">(attr, value)</span>:</span></span><br><span class="line">    objects = ce.getObjectsFrom(ce.scene)</span><br><span class="line">    selection = []</span><br><span class="line">    <span class="keyword">for</span> o <span class="keyword">in</span> objects:</span><br><span class="line">        attrvalue = ce.getAttribute(o, attr)</span><br><span class="line">        <span class="keyword">if</span> attrvalue  ==  value:</span><br><span class="line">            selection.append(o)     </span><br><span class="line">    ce.setSelection(selection)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    selectByAttribute(<span class="string">"connectionStart"</span>,<span class="string">"JUNCTION"</span>)</span><br></pre></td></tr></table></figure><h2 id="Example-2-修改对象属性"><a href="#Example-2-修改对象属性" class="headerlink" title="Example 2  修改对象属性"></a>Example 2  修改对象属性</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Created on 2018-4-9</span></span><br><span class="line"><span class="string">@author: kikita</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">from</span> scripting <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># get a CityEngine instance</span></span><br><span class="line">ce = CE()</span><br><span class="line"></span><br><span class="line"><span class="string">''' increment the street width parameter of all selected street segments'''</span></span><br><span class="line"><span class="comment"># @noUIupdate</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">incrementStreetWidths</span><span class="params">(increment)</span>:</span></span><br><span class="line">    selectedSegments = ce.getObjectsFrom(ce.selection, ce.isGraphSegment)</span><br><span class="line">    <span class="keyword">for</span> segment <span class="keyword">in</span> selectedSegments:</span><br><span class="line">        oldWidth = ce.getAttribute(segment, <span class="string">"/ce/street/streetWidth"</span>)</span><br><span class="line">        newWidth = oldWidth+increment</span><br><span class="line">        ce.setAttribute(segment, <span class="string">"/ce/street/streetWidth"</span>, newWidth)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    incrementStreetWidths(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><h2 id="Example-3-动态模拟建筑物生长"><a href="#Example-3-动态模拟建筑物生长" class="headerlink" title="Example 3 动态模拟建筑物生长"></a>Example 3 动态模拟建筑物生长</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Created on 2018-4-12</span></span><br><span class="line"><span class="string">@author: kikita</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">from</span> scripting <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># get a CityEngine instance</span></span><br><span class="line">ce = CE()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">growBuilding</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">14</span>):</span><br><span class="line">        height = <span class="number">20</span>+i</span><br><span class="line">        doStep(i,height,<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">15</span>,<span class="number">35</span>):</span><br><span class="line">        height = <span class="number">34</span></span><br><span class="line">        width = i<span class="number">-14</span></span><br><span class="line">        doStep(i,height,width)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">doStep</span><span class="params">(i,height,width)</span>:</span>    </span><br><span class="line">    object = ce.getObjectsFrom(ce.scene, ce.withName(<span class="string">"'Lot1'"</span>))</span><br><span class="line">    ce.setAttributeSource(object, <span class="string">"height"</span>, <span class="string">"OBJECT"</span>)</span><br><span class="line">    ce.setAttributeSource(object, <span class="string">"width"</span>, <span class="string">"OBJECT"</span>)</span><br><span class="line">    ce.setAttribute(object, <span class="string">"height"</span>, height)</span><br><span class="line">    ce.setAttribute(object, <span class="string">"width"</span>, width)  </span><br><span class="line">    Generate(object)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Generate</span><span class="params">(object)</span>:</span></span><br><span class="line">    ce.generateModels(object)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">   growBuilding()</span><br></pre></td></tr></table></figure><h2 id="Example-4-陈列资源库"><a href="#Example-4-陈列资源库" class="headerlink" title="Example 4 陈列资源库"></a>Example 4 陈列资源库</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Created on 2018-4-12</span></span><br><span class="line"><span class="string">@author: kikita</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">from</span> scripting <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># get a CityEngine instance</span></span><br><span class="line">ce = CE()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writeCGAlib</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># open the cga file to be written</span></span><br><span class="line">    cga = <span class="string">"/*Asset Library Loader : Generated by asset_lib.py*/\n version \"2014.0\"\n\n"</span>   </span><br><span class="line">    <span class="comment"># write start rule</span></span><br><span class="line">    cga += <span class="string">"Lot --&gt;  Geometries Textures"</span>  </span><br><span class="line">    <span class="comment"># write rule showing geometries</span></span><br><span class="line">    cga += <span class="string">"\n\nGeometries --&gt; "</span>   </span><br><span class="line">    <span class="comment"># get all .obj files from asset directory, and call their loader</span></span><br><span class="line">    <span class="keyword">for</span> obj <span class="keyword">in</span> ce.getObjectsFrom(<span class="string">"/"</span>, ce.isFile, ce.withName(<span class="string">"/Tutorial_10*/assets/*.obj"</span>)):    </span><br><span class="line">        <span class="comment"># and write </span></span><br><span class="line">        cga += <span class="string">"\n\t t(2,0,0)  Geometry(\""</span>+obj+<span class="string">"\")"</span></span><br><span class="line">        <span class="keyword">print</span> obj</span><br><span class="line">    <span class="comment"># write rule showing jpg textures</span></span><br><span class="line">    cga += <span class="string">"\n\nTextures --&gt; \n\ts(1,0,0) set(scope.tz,0) set(scope.ty,3) i(\"facades/xy-plane.obj\")"</span></span><br><span class="line">    <span class="comment"># get all .jpg files from asset directory, and call their loader</span></span><br><span class="line">    <span class="keyword">for</span> jpg <span class="keyword">in</span> ce.getObjectsFrom(<span class="string">"/"</span>, ce.isFile, ce.withName(<span class="string">"/Tutorial_10*/assets/*.jpg"</span>)):</span><br><span class="line">        cga += <span class="string">"\n\tt(2,0,0)  Texture(\""</span>+jpg+<span class="string">"\")"</span></span><br><span class="line">    <span class="comment">#write geometry loader rule</span></span><br><span class="line">    cga += <span class="string">"\n\n Geometry(asset) --&gt; s(1,0,0) i(asset) set(scope.ty,0) set(scope.tz,0)"</span></span><br><span class="line">    <span class="comment">#write texture loader rule</span></span><br><span class="line">    cga += <span class="string">"\n\n Texture(asset) --&gt; set(material.colormap, asset)"</span>    </span><br><span class="line">    cgafile = ce.toFSPath(<span class="string">"rules/asset_lib2.cga"</span>)</span><br><span class="line">    CGA = open(cgafile, <span class="string">"w"</span>)</span><br><span class="line">    CGA.write(cga)</span><br><span class="line">    CGA.close()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"written file "</span>+cgafile</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">assignAndGenerateLib</span><span class="params">()</span>:</span></span><br><span class="line">    object = ce.getObjectsFrom(ce.scene, ce.withName(<span class="string">"'Lot2'"</span>))</span><br><span class="line">    ce.refreshWorkspace()</span><br><span class="line">    ce.setRuleFile(object, <span class="string">"asset_lib2.cga"</span>)</span><br><span class="line">    ce.setStartRule(object, <span class="string">"Lot"</span>)</span><br><span class="line">    ce.generateModels(object)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    writeCGAlib()</span><br><span class="line">    assignAndGenerateLib()</span><br></pre></td></tr></table></figure><h2 id="Example-5-扩展CityEngine功能"><a href="#Example-5-扩展CityEngine功能" class="headerlink" title="Example 5 扩展CityEngine功能"></a>Example 5 扩展CityEngine功能</h2><p>相关的python功能实现后，确保在CityEngine的python editor中可以正常运行。然后，在CityEngine的工作空间根目录创建 scripting.py 文件，内容如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">sys.path.append(&#123;PATH_TO_YOUR_SCRIPTS_DIRECTORY&#125;)</span><br><span class="line"><span class="comment"># e.g. sys.path.append("C:\user\CityEngine\MyProject\scripts")</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># import customized python module</span></span><br><span class="line"><span class="keyword">import</span> myEfficiencyModule</span><br></pre></td></tr></table></figure><p>重启CE之后，可以在python编辑器或控制台中直接使用此模块的功能。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>myEfficiencyModule.selectByAttribute(<span class="string">"connectionEnd"</span>, <span class="string">"JUNCTION"</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;​        CityEngine的同义词几乎就是“规则建模”，规则指的是CGA脚本。说到脚本，很多用户又会联想到 Python， 衍生出来的问题就是，“CityEngine中是用python脚本建模吗？”  答案是No。&lt;/p&gt;
&lt;p&gt;​         CityEn
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
      <category term="Python" scheme="http://www.kikitamap.com/tags/Python/"/>
    
      <category term="3D" scheme="http://www.kikitamap.com/tags/3D/"/>
    
      <category term="CityEngine" scheme="http://www.kikitamap.com/tags/CityEngine/"/>
    
      <category term="CGA" scheme="http://www.kikitamap.com/tags/CGA/"/>
    
  </entry>
  
  <entry>
    <title>Parthenon Temple</title>
    <link href="http://www.kikitamap.com/2018/04/04/Parthenon/"/>
    <id>http://www.kikitamap.com/2018/04/04/Parthenon/</id>
    <published>2018-04-04T04:00:00.000Z</published>
    <updated>2018-07-13T06:17:15.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>摄于 2014-5-9, Acropolis, Athens, Greece</p></blockquote><p>CityEngine的教程中刚好有个Parthenon Temple 的 Demo</p><p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/XJL_ParthenonModel.png-kikitaMaps" alt=""></p><p>不禁会想起在雅典卫城里它的断壁残垣，晒晒我们的合影</p><p>不知道几年过去，修复工作又向前推进了多少</p><p>那些带有编号的石头是不是已经归位了呢</p><p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/XJL_Athens.jpg-kikitaMaps" alt=""></p><p>整个卫城中我最喜欢的是上图中最后一张的“厄瑞克忒翁神庙”，据说用于供奉雅典娜、波塞冬和英雄厄瑞克忒翁。</p><p>神庙一侧的女神柱像精致优美，即使经过了这么多的时光，都可以感受到雕刻师的精湛技艺。</p><p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/XJL_IMG_3545.JPG-kikitaMaps" alt="厄瑞克忒翁神庙"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;摄于 2014-5-9, Acropolis, Athens, Greece&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;CityEngine的教程中刚好有个Parthenon Temple 的 Demo&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http:
      
    
    </summary>
    
      <category term="相机里" scheme="http://www.kikitamap.com/categories/%E7%9B%B8%E6%9C%BA%E9%87%8C/"/>
    
    
      <category term="3D" scheme="http://www.kikitamap.com/tags/3D/"/>
    
      <category term="CityEngine" scheme="http://www.kikitamap.com/tags/CityEngine/"/>
    
  </entry>
  
  <entry>
    <title>CityEngine中纹理贴图之道(二)</title>
    <link href="http://www.kikitamap.com/2018/03/30/textureinCE2/"/>
    <id>http://www.kikitamap.com/2018/03/30/textureinCE2/</id>
    <published>2018-03-30T06:54:44.000Z</published>
    <updated>2018-07-13T06:16:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>​        接着<a href="http://kikitamap.com/2018/03/22/textureinCE/" target="_blank" rel="noopener">上一篇</a>。</p><p>​       <img src="http://7xs3vz.com1.z0.glb.clouddn.com/MGKW_ceTexturing_6.png-kikitaMaps" alt=""></p><p>​        为了让脚本看起来更连贯，无需跳转上一篇，我们从头开始。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * File:    MyTestforBaseTexure.cga</span></span><br><span class="line"><span class="comment"> * Created: 30 Mar 2018 08:16:37 GMT</span></span><br><span class="line"><span class="comment"> * Author:  Xiaoyan Mu</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">version <span class="string">"2017.1"</span></span><br><span class="line">attr height = <span class="number">10</span></span><br><span class="line">attr groundfloor_height = <span class="number">4</span></span><br><span class="line">attr floor_height = <span class="number">3.5</span></span><br><span class="line">attr tile_width = <span class="number">3.5</span></span><br><span class="line"></span><br><span class="line">wall_tex        = <span class="string">"facades/textures/brickwall.jpg"</span></span><br><span class="line">dirt_tex        = <span class="string">"facades/textures/dirtmap.15.tif"</span></span><br><span class="line">graffiti_tex    = <span class="string">"facades/textures/Graffiti.jpg"</span></span><br><span class="line">window_tex      = <span class="string">"facades/textures/window.5.tif"</span></span><br><span class="line"></span><br><span class="line">Lot --&gt; extrude(height) Building</span><br><span class="line"></span><br><span class="line">Building --&gt; comp(f) &#123;<span class="attr">front</span> : Sidefacade&#125;</span><br></pre></td></tr></table></figure><p>​        假设我希望在这面墙上“凿”出窗户，就需要将<code>Sidefacade</code>进行细化切割。贴纹理时也要注意一下新的技巧，也就是在细分表面之前先定义纹理UV，细分之后再用上一篇中提到的贴纹理的方法应用到<code>Wall</code>，这样就可以得到连续的墙体贴图。这样的做的原因在于，CE中的shape都是被不断迭代替换的，如果不在细分之前定义UV，<code>Sidefacade</code>对象在细分之后已经消亡了。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># Sidefacade is modified</span><br><span class="line"></span><br><span class="line">Sidefacade --&gt;  </span><br><span class="line">    # Setup texturing</span><br><span class="line">    setupProjection(<span class="number">1</span>, scope.xy, <span class="number">1.5</span>, <span class="number">1</span>) </span><br><span class="line">    setupProjection(<span class="number">2</span>, scope.xy, scope.sx, scope.sy)</span><br><span class="line">    # Divide Sidefacade</span><br><span class="line"> split(y)&#123; <span class="attr">groundfloor_height</span>: Wall | &#123;~floor_height : Floor&#125;* &#125;</span><br><span class="line"></span><br><span class="line">Floor --&gt;</span><br><span class="line">split(x)&#123; <span class="number">1</span> : Wall | &#123; ~tile_width : Tile &#125;* | <span class="number">1</span> : Wall &#125;            </span><br><span class="line">Tile --&gt;</span><br><span class="line">split(x)&#123; ~<span class="number">1</span> : Wall |  <span class="number">2</span> : split(y)&#123; ~<span class="number">1</span>: Wall | <span class="number">1.5</span>: Window | ~<span class="number">1</span>: Wall &#125; | ~<span class="number">1</span> : Wall &#125;</span><br><span class="line"></span><br><span class="line">Wall --&gt;</span><br><span class="line">    # Apply the texture         </span><br><span class="line">    set(material.bumpmap,wall_tex)</span><br><span class="line">    set(material.dirtmap, dirt_tex)</span><br><span class="line">    projectUV(<span class="number">1</span>)</span><br><span class="line">    projectUV(<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">Window --&gt;</span><br><span class="line">    offset(<span class="number">0.05</span>) </span><br><span class="line">    comp(f) &#123; <span class="attr">inside</span>: WondowInner | border: WondowFrame &#125;</span><br><span class="line">    WondowInner --&gt;</span><br><span class="line">  setupProjection(<span class="number">0</span>, scope.xy, scope.sx,  scope.sy) </span><br><span class="line">  texture(window_tex)</span><br><span class="line">projectUV(<span class="number">0</span>)      </span><br><span class="line">      WondowFrame --&gt;</span><br><span class="line">      extrude(<span class="number">0.1</span>)</span><br></pre></td></tr></table></figure><h2 id="material-opacitymap"><a href="#material-opacitymap" class="headerlink" title="material.opacitymap"></a>material.opacitymap</h2><p><code>material.opacitymap</code> 通道可以用于控制纹理的透明度。</p><p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/MGKW_ceTexturing_7.png-kikitaMaps" alt=""></p><p>继续上面的例子，如果希望做出透明的窗户效果，可以将Window的代码替换为如下的样子。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Window --&gt;</span><br><span class="line">    offset(<span class="number">0.05</span>) </span><br><span class="line">    comp(f) &#123; <span class="attr">inside</span>: WondowInner | border: WondowFrame &#125;</span><br><span class="line">    WondowInner --&gt;    </span><br><span class="line">      setupProjection(<span class="number">4</span>, scope.xy, scope.sx,  scope.sy) </span><br><span class="line">      set(material.opacitymap, window_tex)</span><br><span class="line">      projectUV(<span class="number">4</span>) </span><br><span class="line">    WondowFrame --&gt;</span><br><span class="line">    extrude(<span class="number">0.1</span>)</span><br></pre></td></tr></table></figure><h2 id="material-specularmap"><a href="#material-specularmap" class="headerlink" title="material.specularmap"></a>material.specularmap</h2><p>为了虚拟现实，窗户玻璃来点反光效果吧。</p><p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/MGKW_ceTexturing_8.png-kikitaMaps" alt=""></p><p>上代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Window --&gt;</span><br><span class="line">    offset(<span class="number">0.05</span>)   </span><br><span class="line">    comp(f) &#123; <span class="attr">inside</span>: WondowInner | border: WondowFrame &#125;</span><br><span class="line">    WondowInner --&gt;   </span><br><span class="line"> setupProjection(<span class="number">0</span>, scope.xy, scope.sx,  scope.sy) </span><br><span class="line"> texture(window_tex)</span><br><span class="line"> projectUV(<span class="number">0</span>)</span><br><span class="line"> set(material.specular.r, <span class="number">1</span>) </span><br><span class="line">     set(material.specular.g, <span class="number">1</span>)   </span><br><span class="line">     set(material.specular.b, <span class="number">1</span>)</span><br><span class="line"> set(material.shininess, <span class="number">2</span>)</span><br><span class="line"> setupProjection(<span class="number">3</span>, scope.xy, scope.sx,  scope.sy)</span><br><span class="line"> set(material.specularmap, specular_tex)</span><br><span class="line"> projectUV(<span class="number">3</span>)</span><br><span class="line">    WondowFrame --&gt;</span><br><span class="line">    extrude(<span class="number">0.1</span>)</span><br></pre></td></tr></table></figure><p>剩下最后的 normalmap了，法向贴图。手里没有什么好例子，找到一篇<a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-13-normal-mapping/" target="_blank" rel="noopener">OpenGL的文档</a>，帮助理解。</p><p>完结。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;​        接着&lt;a href=&quot;http://kikitamap.com/2018/03/22/textureinCE/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;上一篇&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;​       &lt;img src=&quot;http:/
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
      <category term="3D" scheme="http://www.kikitamap.com/tags/3D/"/>
    
      <category term="CityEngine" scheme="http://www.kikitamap.com/tags/CityEngine/"/>
    
      <category term="CGA" scheme="http://www.kikitamap.com/tags/CGA/"/>
    
  </entry>
  
  <entry>
    <title>CityEngine中纹理贴图之道(一)</title>
    <link href="http://www.kikitamap.com/2018/03/22/textureinCE/"/>
    <id>http://www.kikitamap.com/2018/03/22/textureinCE/</id>
    <published>2018-03-22T09:39:33.000Z</published>
    <updated>2018-07-13T06:16:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>​        </p><p>​        经常看到官微、公众号的各种推送，了解到很多轰动一时的大片和电游的视觉制作都有CityEngine 助力过。CityEngine 在影娱视觉行业早已硕果累累，而对于GIS大众，CityEngine 算是刚从幕后走到了台前，从神秘娱乐圈走近了烟火人间。这几年来，这个不姓“Arc”的非主流产品在不断地推陈出新，吸引着慕名围观的用户去了解。3D模型的纹理贴图问题通常是建模中的高频问题，作为前排围观群众之一，我今天就用CityEngine做一面“墙”娱乐一下吧。</p><blockquote><p>环境： Esri City Engine 2017.1</p></blockquote><p>​        在 CityEngine中的 <code>shape</code> 对象具有<code>material</code>属性，这一属性可以控制模型的纹理贴图、阴影效果、外观等。CityEngine 支持的纹理图片的格式有：<strong>.bmp、.gif、.jpg/.jpeg、.png、.tif/.tiff</strong>。 CityEngine贴图支持6个纹理通道，它们通过特定的关键字来表达，如下：</p><table><thead><tr><th>uv-set</th><th>Texture Layer</th></tr></thead><tbody><tr><td>0</td><td>colormap</td></tr><tr><td>1</td><td>bumpmap</td></tr><tr><td>2</td><td>dirtmap</td></tr><tr><td>3</td><td>specularmap</td></tr><tr><td>4</td><td>opacitymap</td></tr><tr><td>5</td><td>normalmap</td></tr></tbody></table><p><strong>下面我通过几个实例来说明下它们的用途：</strong></p><p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/MGKW_ceTexturing_1.png-kikitaMaps" alt=""></p><p>​        基于共同的基础脚本向下进行，这里不再解释，相信你一看即懂。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * File:    MyTestforBaseTexure.cga</span></span><br><span class="line"><span class="comment"> * Created: 21 Mar 2018 08:26:37 GMT</span></span><br><span class="line"><span class="comment"> * Author:  Xiaoyan Mu</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">version <span class="string">"2017.1"</span></span><br><span class="line">attr height = <span class="number">6</span></span><br><span class="line">wall_tex        = <span class="string">"facades/textures/brickwall.jpg"</span></span><br><span class="line">dirt_tex        = <span class="string">"facades/textures/dirtmap.15.tif"</span></span><br><span class="line">graffiti_tex    = <span class="string">"facades/kiktia/Graffiti.jpg"</span></span><br><span class="line">Lot --&gt; extrude(height) Building</span><br><span class="line">Building --&gt; comp(f) &#123;<span class="attr">side</span> : Sidefacade&#125;</span><br></pre></td></tr></table></figure><h2 id="material-colormap"><a href="#material-colormap" class="headerlink" title="material.colormap"></a>material.colormap</h2><p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/MGKW_ceTexturing_2.png-kikitaMaps" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Sidefacade --&gt;</span><br><span class="line">setupProjection(<span class="number">0</span>, scope.xy, <span class="number">1.5</span>, <span class="number">1</span>, <span class="number">1</span>) </span><br><span class="line">texture(wall_tex)  # set(material.colormap,wall_tex)</span><br><span class="line">projectUV(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>​        <code>texture(wall_tex)</code> ，实际是 <code>set(material.colormap,wall_tex)</code> 的简写，这个函数仅用于为当前shape指定纹理图片，而没有创建纹理坐标系。因此事先需要使用 <code>setupProjection()</code> ，用于指定贴图表面上的UV坐标系，以及贴图矩阵的排布样式。最后使用 <code>ProjectUV()</code>将贴图UV坐标系应用到贴图表面，这个过程有时被称为“烘焙（bake）”。相关函数的具体语法请查 <a href="http://cehelp.esri.com/help/index.jsp?topic=/com.procedural.cityengine.help/html/toc.html" target="_blank" rel="noopener"><strong>帮助</strong></a>。</p><p>​        “烘焙”是个形象生动的词，是个3D建模领域的常用词，对于GIS圈子的朋友可能有点陌生，在一个<strong><a href="https://www.blenderartists.org/forum/showthread.php?116259-what-is-texture-baking" target="_blank" rel="noopener">论坛</a></strong>里找到一个描述觉得不错分享大家。</p><blockquote><p>“Baking” generally refers to the process of recording as an image, some aspect of the Material or Mesh characteristics of a model. One value of this is that certain kinds of Material parameters can take longer to compute and apply to a model than an Image Texture, so it saves rendering time. Baking is usually done once a Material or Mesh is finalized. </p><p>In texture baking, for example, what is originally a procedural texture can be recorded as an image. Sometimes various “channels” of a material can be consolidated into a single image, simplifying the number of texture images used. Material colors applied in Texture Paint mode can be saved to an image. Texture baking can also help with disguising seams on a UV unwrap, a somewhat complicated but very useful process.</p><p>In normal baking, the mesh normals (which affect how light appears to reflect from the model’s surface) can be recorded – this results in very specialized images with RGB values based on normal vectors.</p><p>Usually baking requires having the model UV-unwrapped and -mapped, so the resulting image is properly fit to the model.</p></blockquote><h2 id="material-bumpmap"><a href="#material-bumpmap" class="headerlink" title="material.bumpmap"></a>material.bumpmap</h2><p>​    <code>material.bumpmap</code> 可以实现贴图的浮雕效果。</p><p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/MGKW_ceTexturing_3.png-kikitaMaps" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Sidefacade --&gt;</span><br><span class="line">setupProjection(<span class="number">1</span>, scope.xy, <span class="number">1.5</span>, <span class="number">1</span>, <span class="number">1</span>) </span><br><span class="line">set(material.bumpmap,wall_tex)  </span><br><span class="line">projectUV(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h2 id="material-dirtmap"><a href="#material-dirtmap" class="headerlink" title="material.dirtmap"></a>material.dirtmap</h2><p>​        如果想使这面墙更逼真，来点“做旧”的感觉，可以使用 <code>material.dirtmap</code> 通道来增加图片镶嵌的效果。</p><p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/MGKW_ceTexturing_4.png-kikitaMaps" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Sidefacade --&gt;</span><br><span class="line">setupProjection(<span class="number">0</span>, scope.xy, <span class="number">1.5</span>, <span class="number">1</span>, <span class="number">1</span>) </span><br><span class="line">texture(wall_tex)</span><br><span class="line">projectUV(<span class="number">0</span>) </span><br><span class="line">    # Add dirtmap channel</span><br><span class="line">    setupProjection(<span class="number">2</span>, scope.xy, scope.sx, scope.sy)</span><br><span class="line">set(material.dirtmap, dirt_tex)</span><br><span class="line">projectUV(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><p>​        相同的方法来做一面涂鸦墙也可以哦。（涂鸦图片来自网络，侵删）</p><p>​        将dirtmap换张图，  <code>set(material.dirtmap, graffiti_tex)</code></p><p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/MGKW_ceTexturing_5.png-kikitaMaps" alt=""></p><p>先到这里，下篇继续……</p><p>## </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;​        &lt;/p&gt;
&lt;p&gt;​        经常看到官微、公众号的各种推送，了解到很多轰动一时的大片和电游的视觉制作都有CityEngine 助力过。CityEngine 在影娱视觉行业早已硕果累累，而对于GIS大众，CityEngine 算是刚从幕后走到了台前，从
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
      <category term="3D" scheme="http://www.kikitamap.com/tags/3D/"/>
    
      <category term="CityEngine" scheme="http://www.kikitamap.com/tags/CityEngine/"/>
    
      <category term="CGA" scheme="http://www.kikitamap.com/tags/CGA/"/>
    
  </entry>
  
  <entry>
    <title>导入3D模型至CityEngine</title>
    <link href="http://www.kikitamap.com/2018/03/21/importingmodels/"/>
    <id>http://www.kikitamap.com/2018/03/21/importingmodels/</id>
    <published>2018-03-21T03:06:12.000Z</published>
    <updated>2018-04-23T01:16:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>我们可以将2D矢量数据、3D模型格式导入到CityEngine 中使用，前者一般作为CityEngine shape 来使用，后者作为模型来使用。</p><p>OBJ，DAE，FBX这几种模型格式导入时可以作为两种角色来使用，shape 或 static model。这是由导入窗口中的 <code>Import as static model</code> 设置控制的。</p><blockquote><p><strong>Import as static model</strong></p><p>When checked, the file will be imported ‘as is’ and will not be modifiable by cga rules.</p><ul><li>Shapes—Serve as a base for CGA generation. A typical example is footprint data.</li><li>Static models—Can be scaled, rotated, and translated after import but cannot be processed further with CGA. </li></ul></blockquote><p>通过如上说明，我们可以清晰的了解到把模型转为shape或Static Model的差异。 一般实际应用中，我们会把当作“素材”使用的模型小件作为static model用；而把表示基础结构的模型作为shape来使用。</p><p>static model导入之后，仍然可以再转换为shape，操作：菜单栏 Shapes-&gt;Convert  Models to Shapes。成为shapes 之后，就可以通过cga对这个模型的继续进行改造了。</p><p>在如下示例图中了解：</p><p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/MGKW_importingModel.png-kikitaMaps" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;我们可以将2D矢量数据、3D模型格式导入到CityEngine 中使用，前者一般作为CityEngine shape 来使用，后者作为模型来使用。&lt;/p&gt;
&lt;p&gt;OBJ，DAE，FBX这几种模型格式导入时可以作为两种角色来使用，shape 或 static model。这是
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
      <category term="3D" scheme="http://www.kikitamap.com/tags/3D/"/>
    
      <category term="CityEngine" scheme="http://www.kikitamap.com/tags/CityEngine/"/>
    
  </entry>
  
  <entry>
    <title>《Scent of a Woman》</title>
    <link href="http://www.kikitamap.com/2018/03/18/ScentofaWoman/"/>
    <id>http://www.kikitamap.com/2018/03/18/ScentofaWoman/</id>
    <published>2018-03-18T04:00:00.000Z</published>
    <updated>2018-03-21T07:30:13.000Z</updated>
    
    <content type="html"><![CDATA[<p>这是一部老片。</p><p>年少无知的时候，看到题目《闻香识女人》，暗自以为这是一部有关调情高手的电影，完全无感，从此错过。</p><p>在没有很多电影可以走入内心的今天，翻看旧电影真的是种享受。竟然有几句台词可以让我记住和感动。</p><blockquote><hr><p>Now I’ve come to the crossroad in my life. I always knew what the right path was.  Without exception.  I knew, but I never took it. You know why. It’s was too damn hard.</p><hr><p>But there is nothing like the sight of an amputated spirit. There is no prosthetic for that.</p><hr></blockquote><p>我虽不是很相信人有灵魂，但我确信看到过人性的高贵。</p><p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/SSN_ScentofaWoman_1.jpg-kikitaMaps" alt=""></p><p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/SSN_ScentofaWoman2.jpg-kikitaMaps" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;这是一部老片。&lt;/p&gt;
&lt;p&gt;年少无知的时候，看到题目《闻香识女人》，暗自以为这是一部有关调情高手的电影，完全无感，从此错过。&lt;/p&gt;
&lt;p&gt;在没有很多电影可以走入内心的今天，翻看旧电影真的是种享受。竟然有几句台词可以让我记住和感动。&lt;/p&gt;
&lt;blockquote&gt;
&lt;h
      
    
    </summary>
    
      <category term="碎碎念" scheme="http://www.kikitamap.com/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
    
  </entry>
  
  <entry>
    <title>OSM在ArcGIS产品线中的使用小结</title>
    <link href="http://www.kikitamap.com/2018/03/15/osm2ce/"/>
    <id>http://www.kikitamap.com/2018/03/15/osm2ce/</id>
    <published>2018-03-15T06:56:00.000Z</published>
    <updated>2018-03-21T06:19:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>说到免费开放的数据，自然会想到 Open Street Map，这里分享下在 ArcGIS 产品线中osm数据的使用实践。</p><blockquote><p>环境：ArcGIS Desktop 10.6， Esri CityEngine 2017.1</p></blockquote><h3 id="在ArcMap中使用osm数据"><a href="#在ArcMap中使用osm数据" class="headerlink" title="在ArcMap中使用osm数据"></a><strong>在ArcMap中使用osm数据</strong></h3><p>一般情况下，我们可以在 <a href="https://www.openstreetmap.org" target="_blank" rel="noopener">Open Street Map</a> 官网可以通过指定范围直接下载osm格式数据，然后在 ArcMap中直接读取。如下，以Esri中国所在的金泰大厦为中心的数据：</p><p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/MGKW_OSM2CE2.png-kikitaMaps" alt="ArcMap直读OSM"></p><p>osm数据是基于xml的数据格式，ArcMap不能直接编辑。如果希望导入地理数据库中编辑，可以利用插件，这是Esri额外提供的一个桌面端的免费开源的osm插件，<a href="https://www.arcgis.com/home/item.html?id=0c4b24608fc94542ba5d1130c0606802" target="_blank" rel="noopener">ArcGIS Editor for OSM 10.6.x Desktop</a>。 通过这个插件可以下载、更新OSM数据有关这个插件的源码、文档，可以在<a href="https://github.com/Esri/arcgis-osm-editor" target="_blank" rel="noopener">Github</a>上获得。</p><blockquote><p>OSM is an XML-based format used to describe vector data in a map. It defines three basic data types—nodes, ways, and closed ways—which are used to describe all the other elements: </p><ul><li>Nodes—Points between which segments are drawn. </li><li>Ways—Ordered list of nodes, displayed as connected by line segments in the editor. </li><li>Closed Ways—Ways that go in a complete loop. They are used to describe areas such as parks, lakes, or islands.</li></ul></blockquote><p>以前10.3年代的时候，整理过一次简单的说明，点<a href="http://kikitamap.com/2015/04/01/ArcGISEditorforOSM103xDesktop/" target="_blank" rel="noopener">这里</a>直达。通过测试，相同的网络环境下，官网下载osm数据，之后再使用 Load OSM File 导入GDB，效率明显优于直接使用 Download OSM Data导入GDB。</p><h3 id="在CityEngine中使用osm数据"><a href="#在CityEngine中使用osm数据" class="headerlink" title="在CityEngine中使用osm数据"></a><strong>在CityEngine中使用osm数据</strong></h3><p>如果osm数据用于CityEngine，那么无需事先导入GDB，CityEngine可以直接解析osm并可分类导入数据，例如下图中导入highway，Building类：</p><p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/MGKW_OSM2CE4.png-kikitaMaps" alt="导入OSM至CityEngine场景"></p><p>在CityEngine中导入osm时，可以勾选“Map OSM tags”，从而CityEngine会通过OSM street type来定义道路的宽度，并给与不同道路组成部分不同的起始规则，方便后续利用规则批量建模。如下，以金泰大厦以南的东直门大枢纽为例，复杂的交通仍然保持错落有致：</p><p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/MGKW_OSM2CE5.png-kikitaMaps" alt="OSM Highway"></p><p>选中<code>Jintai_Streets</code> 这个图层，可以在Inspect窗口中看到图层的属性，其中即为默认情况下osm数据在CityEngine中的映射规则，可以根据需要修改：</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//------------------------- </span></span><br><span class="line"><span class="comment">// Example OSM Tag Mapping</span></span><br><span class="line"></span><br><span class="line">streetscale = <span class="number">1</span>  <span class="comment">// street width scale factor</span></span><br><span class="line"></span><br><span class="line">width = getObjectAttr(<span class="string">"width"</span>, <span class="literal">false</span>)</span><br><span class="line">lanes = getObjectAttr(<span class="string">"lanes"</span>, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">attr streetWidth = <span class="comment">// street width dependeding on available attributes</span></span><br><span class="line">    <span class="keyword">case</span> width &gt; <span class="number">0</span> : width       * streetscale</span><br><span class="line">    <span class="keyword">case</span> lanes &gt; <span class="number">0</span> : lanes * <span class="number">3.5</span> * streetscale</span><br><span class="line">    <span class="keyword">else</span>           : streetWidthByClass * streetscale * oneway</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> = getObjectAttr(<span class="string">"highway"</span>, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">streetWidthByClass =</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">class</span> == <span class="string">"primary"</span>     : <span class="number">8</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">class</span> == <span class="string">"secondary"</span>   : <span class="number">7</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">class</span> == <span class="string">"tertiary"</span>    : <span class="number">6</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">class</span> == <span class="string">"motorway"</span>    : <span class="number">12</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">class</span> == <span class="string">"trunk"</span>       : <span class="number">11</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">class</span> == <span class="string">"road"</span>        : <span class="number">6</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">class</span> == <span class="string">"residential"</span> : <span class="number">5</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">class</span> == <span class="string">"footway"</span>     : <span class="number">2</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">class</span> == <span class="string">"cycleway"</span>    : <span class="number">2</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">class</span> == <span class="string">"steps"</span>       : <span class="number">2</span></span><br><span class="line">    <span class="keyword">else</span>                        : <span class="number">4</span></span><br><span class="line"></span><br><span class="line">oneway = <span class="comment">// oneway width correction</span></span><br><span class="line">    <span class="function"><span class="keyword">case</span> <span class="title">getObjectAttr</span>(<span class="params"><span class="string">"oneway"</span>, <span class="literal">false</span></span>) </span>== <span class="string">"yes"</span> : <span class="number">0.5</span></span><br><span class="line">    <span class="keyword">else</span>                                  : <span class="number">1</span></span><br><span class="line"></span><br><span class="line">sidewalkscale = <span class="number">1</span> <span class="comment">// sidewalk width scale factor</span></span><br><span class="line"></span><br><span class="line">sidewalkWidth =</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">class</span> == <span class="string">"primary"</span>     : <span class="number">2</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">class</span> == <span class="string">"secondary"</span>   : <span class="number">2</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">class</span> == <span class="string">"tertiary"</span>    : <span class="number">2</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">class</span> == <span class="string">"residential"</span> : <span class="number">2</span></span><br><span class="line">    <span class="keyword">else</span>                        : <span class="number">0</span></span><br><span class="line"></span><br><span class="line">attr sidewalkWidthLeft = sidewalkWidth * sidewalkscale</span><br><span class="line">attr sidewalkWidthRight = sidewalkWidth * sidewalkscale</span><br></pre></td></tr></table></figure><p>默认情况下，进入cityEngine中的道路数据，会使用Esri.lib库中的规则Street_Modern_Standard.cga，当然也可以自己来编写。</p><p><img src="http://7xs3vz.com1.z0.glb.clouddn.com/MGKW_OSM2CE6.png-kikitaMaps" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;说到免费开放的数据，自然会想到 Open Street Map，这里分享下在 ArcGIS 产品线中osm数据的使用实践。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;环境：ArcGIS Desktop 10.6， Esri CityEngine 2017.1&lt;/p&gt;
&lt;/bl
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
      <category term="Geodata" scheme="http://www.kikitamap.com/tags/Geodata/"/>
    
      <category term="CityEngine" scheme="http://www.kikitamap.com/tags/CityEngine/"/>
    
  </entry>
  
  <entry>
    <title>CityEngine中的Terrain Map Layer</title>
    <link href="http://www.kikitamap.com/2018/03/13/CEMaplayer/"/>
    <id>http://www.kikitamap.com/2018/03/13/CEMaplayer/</id>
    <published>2018-03-13T04:40:14.000Z</published>
    <updated>2018-03-15T02:36:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>​    CityEngine 中的Map Layer可以参与到批量建模当中，根据角色的不同可以分为Terrain，Texture，Obstacle，Mapping，Function几个类型的图层。</p><p><strong>Terrain Map Layer</strong> </p><p>​    顾名思义，用于表示场景的地表结构和底图图层，这个图层可以由一个DEM和一个影像共同构成。 这类图层在创建的时候，可以设置影像取值的通道、高程的拉伸范围、影像的尺寸、锚点位置、偏移量等参数。</p><p>​    在图层创建之后，我们可以看到属性窗口中，有这样一段代码表述了上面的一些设置：</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attr elevation = map_01(<span class="name">brightness</span>, <span class="number">0.0</span>, <span class="number">150.0</span>) + elevationDelta</span><br></pre></td></tr></table></figure><p>这时，有个疑问，<code>elevationDelta</code> 是什么？如何体现出来的？带着这个疑问我们来看看CE对于场景高程的作用机制。</p><p>导入CE场景中的道路线数据一般被识别为Graph Segment，静态模型一般为Static Shape，这两种类型数据可以通过 Align graph to terrain，Align shapes to terrain 来向地形数据对齐。在实际应用中，很多建筑物或道路的底面是个平面，需要将地形整平到与模型底面完美贴合，这时再使用工具 Align terrain to shape 来解决这个问题。</p><p>这时保存场景，在CE的工程目录的data文件夹下，就会出现一个场景同名的文件夹，并在其下自动生成一个16bit的栅格数据，储存地形变化量，这个栅格数据即为 elevationDelta。当预览数据时，从渲染方案上可以得到直观印象，灰色为无变化，黑色为减低，白色为增加。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;​    CityEngine 中的Map Layer可以参与到批量建模当中，根据角色的不同可以分为Terrain，Texture，Obstacle，Mapping，Function几个类型的图层。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Terrain Map Layer&lt;/str
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
  </entry>
  
  <entry>
    <title>如何部署通过Portal管理的ArcGIS Pro Named User许可？</title>
    <link href="http://www.kikitamap.com/2018/03/09/ProNamedUserforPortalUse/"/>
    <id>http://www.kikitamap.com/2018/03/09/ProNamedUserforPortalUse/</id>
    <published>2018-03-09T03:50:45.000Z</published>
    <updated>2018-05-25T07:38:33.000Z</updated>
    
    <content type="html"><![CDATA[<p>在开始如下部署之前，一定要注意下<strong>版本对应</strong>的情况，否则会部署失败：</p><table><thead><tr><th>版本</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td></td><td>Portal 10.6</td><td>Portal 10.5.1</td><td>Portal 10.5</td><td>Portal10.4.1</td></tr><tr><td>Pro 2.1</td><td>LM 10.6</td><td>不支持</td><td>不支持</td><td>不支持</td></tr><tr><td>Pro 2.0</td><td>LM 10.6</td><td>LM 10.5.1、10.6</td><td>LM 10.5.1、10.6</td><td>不支持</td></tr><tr><td>Pro 1.4</td><td>LM 10.6</td><td>LM 10.5.1、10.6</td><td>LM 10.5、10.5.1、10.6</td><td>LM 10.4.1</td></tr></tbody></table><p><em>LM : License Manager,  Portal: Portal for ArcGIS;   Pro: ArcGIS Pro</em> </p><p><br></p><p>如果您购买并已经部署了 Portal for ArcGIS，搭建了您的组织门户， 并且您希望在内网环境中通过 Named User 方式使用 ArcGIS Pro，那么您可以选择通过Portal for ArcGIS为组织成员配置Named User许可的方式。</p><h2 id="1-为组织配置-ArcGIS-Pro-许可"><a href="#1-为组织配置-ArcGIS-Pro-许可" class="headerlink" title="1 为组织配置 ArcGIS Pro 许可"></a>1 为组织配置 ArcGIS Pro 许可</h2><p><strong>1)</strong> 首先您需要确定哪个组织门户将用于管理ArcGIS Pro的许可（这个指定的组织门户称为“许可门户”）， 尤其当您的组织有多个门户的时候，请确保您指定的门户是您想要用来管理许可的那个门户。此种许可模式，需要安装ArcGIS License Server Administrator 程序。</p><p><strong>2)</strong> 完成安装后，打开 ArcGIS License Server Administrator，并单击“计算机 ID…” 按钮。</p><p><img src="http://images.esrichina.com.cn/article/20170310/dbb2b70dea49a6649e5fed410bf1dc28.png" alt=""></p><p><strong>3)</strong> 复制并保存计算机标识符对话框中的 MAC 地址 </p><ul><li>例如，005056a700c7（您需要向 My Esri 提供此信息）。 如果该对话框中存在两个 MAC 地址，则只复制其中之一。</li></ul><p><img src="http://images.esrichina.com.cn/article/20170310/0f5f97c5f0d6bebb6ced505533453c09.png" alt=""></p><p>4) 请记录上一步中您的Mac地址，并且提供您以下信息之一（用户ID、合同编号、用户单位全称），致电易智瑞(中国)信息技术有限公司合同部，为您生成可用于配置许可门户的文件（*.lic）。<br>联系电话： 010-5673228，拨0，转合同部。</p><p>5) 当您收到合同部发送的文件 (*.lic)之后， 将其保存到前面安装了 ArcGIS License Server Administrator 的计算机可访问的目录中。</p><p>6) 打开 ArcGIS License Server Administrator 并启动许可服务（如果未运行）。 单击“授权”选项卡，选择“版本”下拉对话框中的“命名用户/Named User”并单击“立即授权”按钮。</p><p><img src="http://images.esrichina.com.cn/article/20170310/67fcfb6b847f3e84ce58d847e50735f9.png" alt=""></p><p>7) 选择“我已收到来自 Esri 的授权文件，现在准备完成授权过程。”，然后浏览至许可 (.lic) 文件, 单击“打开”。</p><p>8) 单击“下一步”。随即显示一个对话框，表明已应用Named User许可。单击“确定”。对话框可能会显示几秒钟，这表示正在重新读取许可。</p><p>9) 单击“可用性”选项卡，并从右上角下拉对话框中选择“命名用户/Named User”。确认显示了预期授权。列出的总数将是Named User实际数量的3倍，这是因为每个Named User 最多允许同时在3个设备上运行 ArcGIS Pro 。</p><p>10) 生成门户配置文件。单击“授权”选项卡，然后单击“生成…”，并将门户配置文件 (.json) 保存到对 Portal for ArcGIS 可见的位置。</p><p><img src="http://images.esrichina.com.cn/article/20170310/8b3564c329df10a6b1f3b1fbb5ffb00d.png" alt=""></p><p>随即会显示一个对话框，表明已在您指定的位置生成了文件。单击“确定”并关闭 ArcGIS License Server Administrator。</p><p>11) 打开Web浏览器, 并以组织中默认管理员角色成员的身份登录到 ArcGIS Portal Directory。URL 地址格式为: <a href="https://portal.domain.com:7443/arcgis/portaladmin" target="_blank" rel="noopener">https://portal.domain.com:7443/arcgis/portaladmin</a>  您登录的门户将成为组织的许可门户。</p><p>12) 单击“系统” &gt; “许可” &gt; “导入授权”。</p><p><img src="http://images.esrichina.com.cn/article/20170310/99df556ff3f049041cfda22f60eb70e2.png" alt=""></p><p>13) 单击“浏览”并选择先前生成的门户配置文件 (.json)。确保应用程序下拉菜单被设为 ArcGIS Pro。</p><p><img src="http://images.esrichina.com.cn/article/20170310/280e7ef674045acae19126fbc2f7bc3f.png" alt=""></p><p>14）单击“导入”，您的组织现在已配置了 ArcGIS Pro 许可。</p><h2 id="2-组织管理员配置ArcGIS-Pro许可"><a href="#2-组织管理员配置ArcGIS-Pro许可" class="headerlink" title="2 组织管理员配置ArcGIS Pro许可"></a>2 组织管理员配置ArcGIS Pro许可</h2><p>本节的配置方法与 ArcGIS Online 组织管理员配置 ArcGIS Pro 许可的方法相似。<br>注意：<br>从 ArcGIS 10.5 版本之后，您只能为达到成员资格级别 2 级的门户成员配置 ArcGIS Pro 许可。</p><h2 id="3-登录并使用ArcGIS-Pro"><a href="#3-登录并使用ArcGIS-Pro" class="headerlink" title="3 登录并使用ArcGIS Pro"></a>3 登录并使用ArcGIS Pro</h2><p>1) 启动 ArcGIS Pro。<br>如果 ArcGIS Pro 已打开，请登出，关闭程序，然后重新启动。只能在首次启动 ArcGIS Pro 时连接至许可门户。</p><p>2) 在 ArcGIS Pro的启动界面中，点击“About ArcGIS Pro”。</p><p><img src="http://images.esrichina.com.cn/article/20170310/bbea712ccfa54d51dc456edb0218fa87.png" alt=""></p><p>3) 在“Licensing”页面中，点击 “Configure your licensing options”。</p><p><img src="http://images.esrichina.com.cn/article/20170310/30bf8e51c3905c389cb36c6e2c93e7e0.png" alt=""></p><p>4) 输入许可门户的 URL，如<a href="https://webadaptor.domain.com/arcgis。" target="_blank" rel="noopener">https://webadaptor.domain.com/arcgis。</a></p><p><img src="http://images.esrichina.com.cn/article/20170310/1b4d6d77d4d9a10691794c2d24c5ddb7.png" alt=""></p><p>5) 单击“OK”。稍后，在登录页面中输入账号密码登录并使用ArcGIS Pro。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在开始如下部署之前，一定要注意下&lt;strong&gt;版本对应&lt;/strong&gt;的情况，否则会部署失败：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;版本&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/th
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
      <category term="Deployment" scheme="http://www.kikitamap.com/tags/Deployment/"/>
    
      <category term="License" scheme="http://www.kikitamap.com/tags/License/"/>
    
      <category term="ArcGIS Enterprise" scheme="http://www.kikitamap.com/tags/ArcGIS-Enterprise/"/>
    
  </entry>
  
  <entry>
    <title>网站主题更换备忘录</title>
    <link href="http://www.kikitamap.com/2018/02/26/sitebuilding/"/>
    <id>http://www.kikitamap.com/2018/02/26/sitebuilding/</id>
    <published>2018-02-26T03:06:22.000Z</published>
    <updated>2018-03-05T02:17:31.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="主题安装"><a href="#主题安装" class="headerlink" title="主题安装"></a>主题安装</h2><p><a href="https://github.com/tufu9441/maupassant-hexo" target="_blank" rel="noopener"><strong>Maupassant 主题</strong></a><br>安装主题和渲染器：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/tufu9441/maupassant-hexo.git themes/maupassant</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install hexo-renderer-pug --save</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install hexo-renderer-sass --save</span></span><br></pre></td></tr></table></figure></p><p>编辑Hexo目录下的 <code>_config.yml</code>，将<code>theme</code>的值改为<code>maupassant</code>。</p><h2 id="功能配置"><a href="#功能配置" class="headerlink" title="功能配置"></a>功能配置</h2><p>默认配置:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">_config.yml_config.ymlfancybox:</span> <span class="literal">true</span> <span class="comment">## If you want to use fancybox please set the value to true.</span></span><br><span class="line"><span class="attr">disqus:</span> <span class="comment">## Your disqus_shortname, e.g. username</span></span><br><span class="line"><span class="attr">gitment:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">false</span> <span class="comment">## If you want to use Gitment comment system please set the value to true.</span></span><br><span class="line"><span class="attr">  owner:</span> <span class="comment">## Your GitHub ID, e.g. username</span></span><br><span class="line"><span class="attr">  repo:</span> <span class="comment">## The repository to store your comments, make sure you're the repo's owner, e.g. imsun.github.io</span></span><br><span class="line"><span class="attr">  client_id:</span> <span class="comment">## GitHub client ID, e.g. 75752dafe7907a897619</span></span><br><span class="line"><span class="attr">  client_secret:</span> <span class="comment">## GitHub client secret, e.g. ec2fb9054972c891289640354993b662f4cccc50</span></span><br><span class="line"><span class="attr">uyan:</span> <span class="comment">## Your uyan_id. e.g. 1234567</span></span><br><span class="line"><span class="attr">livere:</span> <span class="comment">## Your livere data-uid, e.g. MTAyMC8zMDAxOC78NTgz</span></span><br><span class="line"><span class="attr">changyan:</span> <span class="comment">## Your changyan appid, e.g. cyrALsXc8</span></span><br><span class="line"><span class="attr">changyan_conf:</span> <span class="comment">## Your changyan conf, e.g. prod_d8a508c2825ab57eeb43e7c69bba0e8b</span></span><br><span class="line"><span class="attr">valine:</span> <span class="comment">## https://valine.js.org</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">false</span> <span class="comment">## If you want to use Valine comment system, please set the value to true.</span></span><br><span class="line"><span class="attr">  appid:</span>  <span class="comment">## Your LeanCloud application App ID, e.g. pRBBL2JR4N7kLEGojrF0MsSs-gzGzoHsz</span></span><br><span class="line"><span class="attr">  appkey:</span>  <span class="comment">## Your LeanCloud application App Key, e.g. tjczHpDfhjYDSYddzymYK1JJ</span></span><br><span class="line"><span class="attr">  notify:</span> <span class="literal">false</span> <span class="comment">## Mail notifier, see https://github.com/xCss/Valine/wiki/Valine-评论系统中的邮件提醒设置</span></span><br><span class="line"><span class="attr">  verify:</span> <span class="literal">false</span> <span class="comment">## Validation code.</span></span><br><span class="line"><span class="attr">  placeholder:</span> <span class="string">Just</span> <span class="string">so</span> <span class="string">so</span> <span class="comment">## Comment box placeholders.</span></span><br><span class="line"><span class="attr">  avatar:</span> <span class="string">'mm'</span> <span class="comment">## Gravatar type, see https://github.com/xCss/Valine/wiki/avatar-setting-for-valine</span></span><br><span class="line"><span class="attr">  pageSize:</span> <span class="number">10</span> <span class="comment">## Number of comments per page.</span></span><br><span class="line"><span class="attr">  guest_info:</span> <span class="string">nick,mail,link</span> <span class="comment">## Attributes of reviewers.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">google_search:</span> <span class="literal">true</span> <span class="comment">## Use Google search, true/false.</span></span><br><span class="line"><span class="attr">baidu_search:</span> <span class="literal">false</span> <span class="comment">## Use Baidu search, true/false.</span></span><br><span class="line"><span class="attr">swiftype:</span> <span class="comment">## Your swiftype_key, e.g. m7b11ZrsT8Me7gzApciT</span></span><br><span class="line"><span class="attr">tinysou:</span> <span class="comment">## Your tinysou_key, e.g. 4ac092ad8d749fdc6293</span></span><br><span class="line"><span class="attr">self_search:</span> <span class="literal">false</span> <span class="comment">## Use a jQuery-based local search engine, true/false.</span></span><br><span class="line"><span class="attr">google_analytics:</span> <span class="comment">## Your Google Analytics tracking id, e.g. UA-42425684-2</span></span><br><span class="line"><span class="attr">baidu_analytics:</span> <span class="comment">## Your Baidu Analytics tracking id, e.g. 8006843039519956000</span></span><br><span class="line"><span class="attr">show_category_count:</span> <span class="literal">false</span> <span class="comment">## If you want to show the count of categories in the sidebar widget please set the value to true.</span></span><br><span class="line"><span class="attr">toc_number:</span> <span class="literal">true</span> <span class="comment">## If you want to add list number to toc please set the value to true.</span></span><br><span class="line"><span class="attr">shareto:</span> <span class="literal">false</span> <span class="comment">## If you want to use the share button please set the value to true, you must have hexo-helper-qrcode installed.</span></span><br><span class="line"><span class="attr">busuanzi:</span> <span class="literal">false</span> <span class="comment">## If you want to use Busuanzi page views please set the value to true.</span></span><br><span class="line"><span class="attr">widgets_on_small_screens:</span> <span class="literal">false</span> <span class="comment">## Set to true to enable widgets on small screens.</span></span><br><span class="line"><span class="attr">canvas_nest:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">false</span> <span class="comment">## If you want to use dynamic background please set the value to true, you can also fill the following parameters to customize the dynamic effect, or just leave them blank to keep the default effect.</span></span><br><span class="line"><span class="attr">  color:</span> <span class="comment">## RGB value of the color, e.g. "100,99,98"</span></span><br><span class="line"><span class="attr">  opacity:</span> <span class="comment">## Transparency of lines, e.g. "0.7"</span></span><br><span class="line"><span class="attr">  zIndex:</span> <span class="comment">## The z-index property of the background, e.g. "-1"</span></span><br><span class="line"><span class="attr">  count:</span> <span class="comment">## Quantity of lines, e.g. "150"</span></span><br><span class="line"><span class="attr">donate:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">false</span> <span class="comment">## If you want to show the donate button after each post, please set the value to true and fill the following items according to your need. You can also enable donate button in a page by adding a "donate: true" item to the front-matter.</span></span><br><span class="line"><span class="attr">  github:</span> <span class="comment">## GitHub URL, e.g. https://github.com/Kaiyuan/donate-page</span></span><br><span class="line"><span class="attr">  alipay_qr:</span> <span class="comment">## Path of Alipay QRcode image, e.g. /img/AliPayQR.png</span></span><br><span class="line"><span class="attr">  wechat_qr:</span> <span class="comment">## Path of Wechat QRcode image, e.g. /img/WeChatQR.png</span></span><br><span class="line"><span class="attr">  btc_qr:</span> <span class="comment">## Path of Bitcoin QRcode image, e.g. /img/BTCQR.png</span></span><br><span class="line"><span class="attr">  btc_key:</span> <span class="comment">## Bitcoin key, e.g. 1KuK5eK2BLsqpsFVXXSBG5wbSAwZVadt6L</span></span><br><span class="line"><span class="attr">  paypal_url:</span> <span class="comment">## Paypal URL, e.g. https://paypal.me/tufu9441</span></span><br><span class="line"></span><br><span class="line"><span class="attr">menu:</span></span><br><span class="line"><span class="attr">  - page:</span> <span class="string">home</span></span><br><span class="line"><span class="attr">    directory:</span> <span class="string">.</span></span><br><span class="line"><span class="attr">    icon:</span> <span class="string">fa-home</span></span><br><span class="line"><span class="attr">  - page:</span> <span class="string">archive</span></span><br><span class="line"><span class="attr">    directory:</span> <span class="string">archives/</span></span><br><span class="line"><span class="attr">    icon:</span> <span class="string">fa-archive</span></span><br><span class="line"><span class="attr">  - page:</span> <span class="string">about</span></span><br><span class="line"><span class="attr">    directory:</span> <span class="string">about/</span></span><br><span class="line"><span class="attr">    icon:</span> <span class="string">fa-user</span></span><br><span class="line"><span class="attr">  - page:</span> <span class="string">rss</span></span><br><span class="line"><span class="attr">    directory:</span> <span class="string">atom.xml</span></span><br><span class="line"><span class="attr">    icon:</span> <span class="string">fa-rss</span></span><br><span class="line"></span><br><span class="line"><span class="attr">widgets:</span> <span class="comment">## Six widgets in sidebar provided: search, category, tag, recent_posts, rencent_comments and links.</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">search</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">category</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">tag</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">recent_posts</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">recent_comments</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">links</span></span><br><span class="line"></span><br><span class="line"><span class="attr">links:</span></span><br><span class="line"><span class="attr">  - title:</span> <span class="string">site-name1</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">http://www.example1.com/</span></span><br><span class="line"><span class="attr">  - title:</span> <span class="string">site-name2</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">http://www.example2.com/</span></span><br><span class="line"><span class="attr">  - title:</span> <span class="string">site-name3</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">http://www.example3.com/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">timeline:</span></span><br><span class="line"><span class="attr">  - num:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">    word:</span> <span class="number">2014</span><span class="string">/06/12-Start</span></span><br><span class="line"><span class="attr">  - num:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">    word:</span> <span class="number">2014</span><span class="string">/11/29-XXX</span></span><br><span class="line"><span class="attr">  - num:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">    word:</span> <span class="number">2015</span><span class="string">/02/18-DDD</span></span><br><span class="line"><span class="attr">  - num:</span> <span class="number">4</span></span><br><span class="line"><span class="attr">    word:</span> <span class="string">More</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Static files</span></span><br><span class="line"><span class="attr">js:</span> <span class="string">js</span></span><br><span class="line"><span class="attr">css:</span> <span class="string">css</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Theme version</span></span><br><span class="line"><span class="attr">version:</span> <span class="number">0.0</span><span class="number">.0</span></span><br></pre></td></tr></table></figure><ul><li>fancybox - 是否启用<a href="http://fancyapps.com/fancybox/" target="_blank" rel="noopener">Fancybox</a>图片灯箱效果</li><li>disqus - <a href="https://disqus.com/" target="_blank" rel="noopener">Disqus评论</a> shortname</li><li>gitment - <a href="https://github.com/imsun/gitment" target="_blank" rel="noopener">Gitment评论</a>相关参数</li><li>uyan - <a href="http://www.uyan.cc/" target="_blank" rel="noopener">友言评论</a> id</li><li>livere - <a href="https://livere.com/" target="_blank" rel="noopener">来必力评论</a> data-uid</li><li>changyan - <a href="http://changyan.kuaizhan.com/" target="_blank" rel="noopener">畅言评论</a> appid</li><li>valine - <a href="https://valine.js.org/" target="_blank" rel="noopener">Valine评论</a>相关参数</li><li>google_search - 默认使用Google搜索引擎</li><li>baidu_search - 若想使用百度搜索，将其设定为<code>true</code>。</li><li>swiftype - <a href="https://swiftype.com/" target="_blank" rel="noopener">Swiftype</a> 站内搜索key</li><li>tinysou - <a href="http://tinysou.com/" target="_blank" rel="noopener">微搜索</a> key</li><li>self_search - 基于jQuery的<a href="http://hahack.com/codes/local-search-engine-for-hexo" target="_blank" rel="noopener">本地搜索引擎</a>，需要安装<a href="https://github.com/PaicHyperionDev/hexo-generator-search" target="_blank" rel="noopener">hexo-generator-search</a>插件使用。</li><li>google_analytics - <a href="https://www.google.com/analytics/" target="_blank" rel="noopener">Google Analytics</a> 跟踪ID</li><li>baidu_analytics - <a href="http://tongji.baidu.com/" target="_blank" rel="noopener">百度统计</a> 跟踪ID</li><li>show_category_count - 是否显示侧边栏分类数目</li><li>toc_number - 是否显示文章中目录列表自动编号</li><li>shareto - 是否使用分享按鈕，需要安装<a href="https://github.com/yscoder/hexo-helper-qrcode" target="_blank" rel="noopener">hexo-helper-qrcode</a>插件使用</li><li>busuanzi - 是否使用<a href="http://busuanzi.ibruce.info/" target="_blank" rel="noopener">不蒜子</a>页面访问计数</li><li>widgets_on_small_screens - 是否在移动设备屏幕底部显示侧边栏</li><li><a href="https://github.com/hustcc/canvas-nest.js/blob/master/README-zh.md" target="_blank" rel="noopener">canvas_nest</a> - 是否使用canvas动态背景</li><li>donate - 是否启用捐赠按钮</li><li>menu - 自定义页面及菜单，依照已有格式填写。填写后请在<code>source</code>目录下建立相应名称的文件夹，并包含<code>index.md</code>文件，以正确显示页面。导航菜单中集成了<a href="http://fontawesome.io/" target="_blank" rel="noopener">FontAwesome</a>图标字体，可以在<a href="http://fontawesome.io/icons/" target="_blank" rel="noopener">这里</a>选择新的图标，并按照相关说明使用。</li><li>widgets - 选择和排列希望使用的侧边栏小工具。</li><li>links - 友情链接，请依照格式填写。</li><li>timeline - 网站历史时间线，在页面<code>front-matter</code>中设置<code>layout: timeline</code>可显示。</li><li>Static files - 静态文件存储路径，方便设置CDN缓存。</li><li>Theme version - 主题版本，便于静态文件更新后刷新CDN缓存。</li></ul><h2 id="主题特性"><a href="#主题特性" class="headerlink" title="主题特性"></a>主题特性</h2><h3 id="网站图标"><a href="#网站图标" class="headerlink" title="网站图标"></a>网站图标</h3><p>若要设置网站Favicon，可以将 <strong>favicon.ico</strong> 放在Hexo根目录的<code>source</code>文件夹下，建议的大小：32px*32px。</p><p>若要为网站添加苹果设备图标，请将命名为 <strong>apple-touch-icon.png</strong> 的图片放在同样的位置，建议的大小：114px*114px。</p><h3 id="文章摘要"><a href="#文章摘要" class="headerlink" title="文章摘要"></a>文章摘要</h3><p>首页默认显示文章摘要而非全文，可以在文章的<code>front-matter</code>中填写一项<code>description:</code>来设置你想显示的摘要，或者直接在文章内容中插入<code>&lt;!--more--&gt;</code>以隐藏后面的内容。<br>若两者都未设置，则自动截取文章第一段作为摘要。</p><h3 id="添加页面"><a href="#添加页面" class="headerlink" title="添加页面"></a>添加页面</h3><p>在<code>source</code>目录下建立相应名称的文件夹，然后在文件夹中建立<code>index.md</code>文件，并在<code>index.md</code>的<code>front-matter</code>中设置layout为<code>layout: page</code>。若需要单栏页面，就将layout设置为 <code>layout: single-column</code>。</p><h3 id="文章目录"><a href="#文章目录" class="headerlink" title="文章目录"></a>文章目录</h3><p>在文章的<code>front-matter</code>中添加<code>toc: true</code>即可让该篇文章显示目录。</p><h3 id="文章评论"><a href="#文章评论" class="headerlink" title="文章评论"></a>文章评论</h3><p>文章和页面的评论功能可以通过在<code>front-matter</code>中设置<code>comments: true</code>或<code>comments: false</code>来进行开启或关闭（默认开启）。</p><h3 id="语法高亮"><a href="#语法高亮" class="headerlink" title="语法高亮"></a>语法高亮</h3><p>要启用代码高亮，请在Hexo目录的<code>_config.yml</code>中将<code>highlight</code>选项按照如下设置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">highlight:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  auto_detect:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  line_number:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  tab_replace:</span></span><br></pre></td></tr></table></figure><h3 id="数学公式"><a href="#数学公式" class="headerlink" title="数学公式"></a>数学公式</h3><p>要启用数学公式支持，请在Hexo目录的<code>_config.yml</code>中添加：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mathjax:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>并在相应文章的<code>front-matter</code>中添加<code>mathjax: true</code>，例如：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">Test</span> <span class="string">Math</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2016</span><span class="bullet">-04</span><span class="bullet">-05</span> <span class="number">14</span><span class="string">:16:00</span></span><br><span class="line"><span class="attr">categories:</span> <span class="string">math</span></span><br><span class="line"><span class="attr">mathjax:</span> <span class="literal">true</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p>数学公式的默认定界符是<code>$$...$$</code>和<code>\\[...\\]</code>（对于块级公式），以及<code>$...$</code>和<code>\\(...\\)</code>（对于行内公式）。</p><p>但是，如果你的文章内容中经常出现美元符号“<code>$</code>”, 或者说你想将“<code>$</code>”用作美元符号而非行内公式的定界符，请在Hexo目录的<code>_config.yml</code>中添加：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mathjax2:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>而不是<code>mathjax: true</code>。 相应地，在需要使用数学公式的文章的<code>front-matter</code>中也添加<code>mathjax2: true</code>。</p><p><a href="http://zhongpu.info/2016/05/06/Mathjax%20and%20Hexo/" target="_blank" rel="noopener">示例</a>。</p><p><a href="https://www.haomwei.com/images/maupassant.jpg" target="_blank" rel="noopener"><img src="https://www.haomwei.com/images/maupassant.jpg" alt="主题效果"></a>主题效果</p><p>转自：<a href="https://www.haomwei.com/technology/maupassant-hexo.html" target="_blank" rel="noopener">屠城: 大道至简——Hexo简洁主题推荐</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;主题安装&quot;&gt;&lt;a href=&quot;#主题安装&quot; class=&quot;headerlink&quot; title=&quot;主题安装&quot;&gt;&lt;/a&gt;主题安装&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/tufu9441/maupassant-hexo&quot; target=&quot;
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
  </entry>
  
  <entry>
    <title>解析xml修改切片原点绕开工具的坑</title>
    <link href="http://www.kikitamap.com/2018/02/05/AlterXMLScheme/"/>
    <id>http://www.kikitamap.com/2018/02/05/AlterXMLScheme/</id>
    <published>2018-02-05T09:00:14.000Z</published>
    <updated>2018-02-08T01:54:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>我们可以通过工具 Generate Map Server Cache Tiling Scheme 来生成自定义的切片方案，无论是ArcMap还是ArcGIS Pro ，无论是栅格切片还是矢量切片，都屡试不爽。</p><p>前段时间，为了方便 ArcGIS Pro 的自动化工作，我尝试用python调用这个功能，然而后面在使用其生成的切片方案（.xml）文件时，会发现切片原点总是默认值，例如地理坐标系统下是“-400,400”。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TileOrigin</span> <span class="attr">xsi:type</span>=<span class="string">"typens:PointN"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">X</span>&gt;</span>-400<span class="tag">&lt;/<span class="name">X</span>&gt;</span><span class="tag">&lt;<span class="name">Y</span>&gt;</span>400<span class="tag">&lt;/<span class="name">Y</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">TileOrigin</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>arcpy.GenerateMapServerCacheTilingScheme_server (in_map, tile_origin, output_tiling_scheme, num_of_scales, scales, dots_per_inch, tile_size)</code> 中，tile_origin这个参数标识为point对象，可是无论如何传参都无效。</p><p>这样会导致切片创建以及更新的一系列问题，在当时也是排查了很久才定位到这个问题。我的是测试环境是 ArcGIS Pro 2.0.x。值得欣慰的是，这个问题在 ArcMap的arcpy中没有问题，可以正确识别参数。</p><p>经过与esri美国工程师的沟通确认，此问题为arcpy for ArcGIS Pro的bug，暂时没有官方解决方法。</p><ul><li><em>BUG-000110503     : Changing the tile origin parameter when using     arcpy.server.GenerateMapServerCacheTilingScheme does not actually change   the tile origin</em></li></ul><p><strong>绕行办法：</strong></p><p>既然xml已经生成了，只有切片原点信息是错误，那就自己来解析xml修改对应参数即可。在自己的脚本中额外增加一个解析xml的逻辑吧，跳过这个坑。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xml.dom.minidom <span class="keyword">as</span> DOM</span><br><span class="line"><span class="comment"># Modify Scheme File to Avoid the tile_Origin Specification Bug of the Pro Tool</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modifyTilingSchemeFile</span><span class="params">(tileScheme,x_origin,y_origin)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        doc = DOM.parse(tileScheme)</span><br><span class="line">        tileOriginX = doc.getElementsByTagName(<span class="string">'X'</span>)</span><br><span class="line">        tileOriginY = doc.getElementsByTagName(<span class="string">'Y'</span>)</span><br><span class="line">        tileOriginX[<span class="number">0</span>].firstChild.data = x_origin</span><br><span class="line">        tileOriginY[<span class="number">0</span>].firstChild.data = y_origin</span><br><span class="line">        f = open(tileScheme, <span class="string">'w+'</span>)</span><br><span class="line">        doc.writexml(f)</span><br><span class="line">        f.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        arcpy.AddMessage(<span class="string">"tile scheme XML file does not exist."</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;我们可以通过工具 Generate Map Server Cache Tiling Scheme 来生成自定义的切片方案，无论是ArcMap还是ArcGIS Pro ，无论是栅格切片还是矢量切片，都屡试不爽。&lt;/p&gt;
&lt;p&gt;前段时间，为了方便 ArcGIS Pro 的自动化
      
    
    </summary>
    
      <category term="木工开物" scheme="http://www.kikitamap.com/categories/%E6%9C%A8%E5%B7%A5%E5%BC%80%E7%89%A9/"/>
    
    
      <category term="Python" scheme="http://www.kikitamap.com/tags/Python/"/>
    
      <category term="ArcGIS Pro" scheme="http://www.kikitamap.com/tags/ArcGIS-Pro/"/>
    
  </entry>
  
</feed>
